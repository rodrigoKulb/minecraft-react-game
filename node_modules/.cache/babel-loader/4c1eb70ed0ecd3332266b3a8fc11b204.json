{"ast":null,"code":"import { EventDispatcher, MOUSE, Quaternion, Vector2, Vector3 } from \"../../../build/three.module.js\";\n\nvar TrackballControls = function (object, domElement) {\n  if (domElement === undefined) console.warn('THREE.TrackballControls: The second parameter \"domElement\" is now mandatory.');\n  if (domElement === document) console.error('THREE.TrackballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.');\n  var scope = this;\n  var STATE = {\n    NONE: -1,\n    ROTATE: 0,\n    ZOOM: 1,\n    PAN: 2,\n    TOUCH_ROTATE: 3,\n    TOUCH_ZOOM_PAN: 4\n  };\n  this.object = object;\n  this.domElement = domElement; // API\n\n  this.enabled = true;\n  this.screen = {\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0\n  };\n  this.rotateSpeed = 1.0;\n  this.zoomSpeed = 1.2;\n  this.panSpeed = 0.3;\n  this.noRotate = false;\n  this.noZoom = false;\n  this.noPan = false;\n  this.staticMoving = false;\n  this.dynamicDampingFactor = 0.2;\n  this.minDistance = 0;\n  this.maxDistance = Infinity;\n  this.keys = [65\n  /*A*/\n  , 83\n  /*S*/\n  , 68\n  /*D*/\n  ];\n  this.mouseButtons = {\n    LEFT: MOUSE.ROTATE,\n    MIDDLE: MOUSE.ZOOM,\n    RIGHT: MOUSE.PAN\n  }; // internals\n\n  this.target = new Vector3();\n  var EPS = 0.000001;\n  var lastPosition = new Vector3();\n  var lastZoom = 1;\n\n  var _state = STATE.NONE,\n      _keyState = STATE.NONE,\n      _eye = new Vector3(),\n      _movePrev = new Vector2(),\n      _moveCurr = new Vector2(),\n      _lastAxis = new Vector3(),\n      _lastAngle = 0,\n      _zoomStart = new Vector2(),\n      _zoomEnd = new Vector2(),\n      _touchZoomDistanceStart = 0,\n      _touchZoomDistanceEnd = 0,\n      _panStart = new Vector2(),\n      _panEnd = new Vector2(); // for reset\n\n\n  this.target0 = this.target.clone();\n  this.position0 = this.object.position.clone();\n  this.up0 = this.object.up.clone();\n  this.zoom0 = this.object.zoom; // events\n\n  var changeEvent = {\n    type: 'change'\n  };\n  var startEvent = {\n    type: 'start'\n  };\n  var endEvent = {\n    type: 'end'\n  }; // methods\n\n  this.handleResize = function () {\n    var box = scope.domElement.getBoundingClientRect(); // adjustments come from similar code in the jquery offset() function\n\n    var d = scope.domElement.ownerDocument.documentElement;\n    scope.screen.left = box.left + window.pageXOffset - d.clientLeft;\n    scope.screen.top = box.top + window.pageYOffset - d.clientTop;\n    scope.screen.width = box.width;\n    scope.screen.height = box.height;\n  };\n\n  var getMouseOnScreen = function () {\n    var vector = new Vector2();\n    return function getMouseOnScreen(pageX, pageY) {\n      vector.set((pageX - scope.screen.left) / scope.screen.width, (pageY - scope.screen.top) / scope.screen.height);\n      return vector;\n    };\n  }();\n\n  var getMouseOnCircle = function () {\n    var vector = new Vector2();\n    return function getMouseOnCircle(pageX, pageY) {\n      vector.set((pageX - scope.screen.width * 0.5 - scope.screen.left) / (scope.screen.width * 0.5), (scope.screen.height + 2 * (scope.screen.top - pageY)) / scope.screen.width // screen.width intentional\n      );\n      return vector;\n    };\n  }();\n\n  this.rotateCamera = function () {\n    var axis = new Vector3(),\n        quaternion = new Quaternion(),\n        eyeDirection = new Vector3(),\n        objectUpDirection = new Vector3(),\n        objectSidewaysDirection = new Vector3(),\n        moveDirection = new Vector3(),\n        angle;\n    return function rotateCamera() {\n      moveDirection.set(_moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0);\n      angle = moveDirection.length();\n\n      if (angle) {\n        _eye.copy(scope.object.position).sub(scope.target);\n\n        eyeDirection.copy(_eye).normalize();\n        objectUpDirection.copy(scope.object.up).normalize();\n        objectSidewaysDirection.crossVectors(objectUpDirection, eyeDirection).normalize();\n        objectUpDirection.setLength(_moveCurr.y - _movePrev.y);\n        objectSidewaysDirection.setLength(_moveCurr.x - _movePrev.x);\n        moveDirection.copy(objectUpDirection.add(objectSidewaysDirection));\n        axis.crossVectors(moveDirection, _eye).normalize();\n        angle *= scope.rotateSpeed;\n        quaternion.setFromAxisAngle(axis, angle);\n\n        _eye.applyQuaternion(quaternion);\n\n        scope.object.up.applyQuaternion(quaternion);\n\n        _lastAxis.copy(axis);\n\n        _lastAngle = angle;\n      } else if (!scope.staticMoving && _lastAngle) {\n        _lastAngle *= Math.sqrt(1.0 - scope.dynamicDampingFactor);\n\n        _eye.copy(scope.object.position).sub(scope.target);\n\n        quaternion.setFromAxisAngle(_lastAxis, _lastAngle);\n\n        _eye.applyQuaternion(quaternion);\n\n        scope.object.up.applyQuaternion(quaternion);\n      }\n\n      _movePrev.copy(_moveCurr);\n    };\n  }();\n\n  this.zoomCamera = function () {\n    var factor;\n\n    if (_state === STATE.TOUCH_ZOOM_PAN) {\n      factor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\n      _touchZoomDistanceStart = _touchZoomDistanceEnd;\n\n      if (scope.object.isPerspectiveCamera) {\n        _eye.multiplyScalar(factor);\n      } else if (scope.object.isOrthographicCamera) {\n        scope.object.zoom *= factor;\n        scope.object.updateProjectionMatrix();\n      } else {\n        console.warn('THREE.TrackballControls: Unsupported camera type');\n      }\n    } else {\n      factor = 1.0 + (_zoomEnd.y - _zoomStart.y) * scope.zoomSpeed;\n\n      if (factor !== 1.0 && factor > 0.0) {\n        if (scope.object.isPerspectiveCamera) {\n          _eye.multiplyScalar(factor);\n        } else if (scope.object.isOrthographicCamera) {\n          scope.object.zoom /= factor;\n          scope.object.updateProjectionMatrix();\n        } else {\n          console.warn('THREE.TrackballControls: Unsupported camera type');\n        }\n      }\n\n      if (scope.staticMoving) {\n        _zoomStart.copy(_zoomEnd);\n      } else {\n        _zoomStart.y += (_zoomEnd.y - _zoomStart.y) * this.dynamicDampingFactor;\n      }\n    }\n  };\n\n  this.panCamera = function () {\n    var mouseChange = new Vector2(),\n        objectUp = new Vector3(),\n        pan = new Vector3();\n    return function panCamera() {\n      mouseChange.copy(_panEnd).sub(_panStart);\n\n      if (mouseChange.lengthSq()) {\n        if (scope.object.isOrthographicCamera) {\n          var scale_x = (scope.object.right - scope.object.left) / scope.object.zoom / scope.domElement.clientWidth;\n          var scale_y = (scope.object.top - scope.object.bottom) / scope.object.zoom / scope.domElement.clientWidth;\n          mouseChange.x *= scale_x;\n          mouseChange.y *= scale_y;\n        }\n\n        mouseChange.multiplyScalar(_eye.length() * scope.panSpeed);\n        pan.copy(_eye).cross(scope.object.up).setLength(mouseChange.x);\n        pan.add(objectUp.copy(scope.object.up).setLength(mouseChange.y));\n        scope.object.position.add(pan);\n        scope.target.add(pan);\n\n        if (scope.staticMoving) {\n          _panStart.copy(_panEnd);\n        } else {\n          _panStart.add(mouseChange.subVectors(_panEnd, _panStart).multiplyScalar(scope.dynamicDampingFactor));\n        }\n      }\n    };\n  }();\n\n  this.checkDistances = function () {\n    if (!scope.noZoom || !scope.noPan) {\n      if (_eye.lengthSq() > scope.maxDistance * scope.maxDistance) {\n        scope.object.position.addVectors(scope.target, _eye.setLength(scope.maxDistance));\n\n        _zoomStart.copy(_zoomEnd);\n      }\n\n      if (_eye.lengthSq() < scope.minDistance * scope.minDistance) {\n        scope.object.position.addVectors(scope.target, _eye.setLength(scope.minDistance));\n\n        _zoomStart.copy(_zoomEnd);\n      }\n    }\n  };\n\n  this.update = function () {\n    _eye.subVectors(scope.object.position, scope.target);\n\n    if (!scope.noRotate) {\n      scope.rotateCamera();\n    }\n\n    if (!scope.noZoom) {\n      scope.zoomCamera();\n    }\n\n    if (!scope.noPan) {\n      scope.panCamera();\n    }\n\n    scope.object.position.addVectors(scope.target, _eye);\n\n    if (scope.object.isPerspectiveCamera) {\n      scope.checkDistances();\n      scope.object.lookAt(scope.target);\n\n      if (lastPosition.distanceToSquared(scope.object.position) > EPS) {\n        scope.dispatchEvent(changeEvent);\n        lastPosition.copy(scope.object.position);\n      }\n    } else if (scope.object.isOrthographicCamera) {\n      scope.object.lookAt(scope.target);\n\n      if (lastPosition.distanceToSquared(scope.object.position) > EPS || lastZoom !== scope.object.zoom) {\n        scope.dispatchEvent(changeEvent);\n        lastPosition.copy(scope.object.position);\n        lastZoom = scope.object.zoom;\n      }\n    } else {\n      console.warn('THREE.TrackballControls: Unsupported camera type');\n    }\n  };\n\n  this.reset = function () {\n    _state = STATE.NONE;\n    _keyState = STATE.NONE;\n    scope.target.copy(scope.target0);\n    scope.object.position.copy(scope.position0);\n    scope.object.up.copy(scope.up0);\n    scope.object.zoom = scope.zoom0;\n    scope.object.updateProjectionMatrix();\n\n    _eye.subVectors(scope.object.position, scope.target);\n\n    scope.object.lookAt(scope.target);\n    scope.dispatchEvent(changeEvent);\n    lastPosition.copy(scope.object.position);\n    lastZoom = scope.object.zoom;\n  }; // listeners\n\n\n  function onPointerDown(event) {\n    if (scope.enabled === false) return;\n\n    switch (event.pointerType) {\n      case 'mouse':\n        onMouseDown(event);\n        break;\n      // TODO touch\n    }\n  }\n\n  function onPointerMove(event) {\n    if (scope.enabled === false) return;\n\n    switch (event.pointerType) {\n      case 'mouse':\n        onMouseMove(event);\n        break;\n      // TODO touch\n    }\n  }\n\n  function onPointerUp(event) {\n    if (scope.enabled === false) return;\n\n    switch (event.pointerType) {\n      case 'mouse':\n        onMouseUp(event);\n        break;\n      // TODO touch\n    }\n  }\n\n  function keydown(event) {\n    if (scope.enabled === false) return;\n    window.removeEventListener('keydown', keydown);\n\n    if (_keyState !== STATE.NONE) {\n      return;\n    } else if (event.keyCode === scope.keys[STATE.ROTATE] && !scope.noRotate) {\n      _keyState = STATE.ROTATE;\n    } else if (event.keyCode === scope.keys[STATE.ZOOM] && !scope.noZoom) {\n      _keyState = STATE.ZOOM;\n    } else if (event.keyCode === scope.keys[STATE.PAN] && !scope.noPan) {\n      _keyState = STATE.PAN;\n    }\n  }\n\n  function keyup() {\n    if (scope.enabled === false) return;\n    _keyState = STATE.NONE;\n    window.addEventListener('keydown', keydown, false);\n  }\n\n  function onMouseDown(event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (_state === STATE.NONE) {\n      switch (event.button) {\n        case scope.mouseButtons.LEFT:\n          _state = STATE.ROTATE;\n          break;\n\n        case scope.mouseButtons.MIDDLE:\n          _state = STATE.ZOOM;\n          break;\n\n        case scope.mouseButtons.RIGHT:\n          _state = STATE.PAN;\n          break;\n\n        default:\n          _state = STATE.NONE;\n      }\n    }\n\n    var state = _keyState !== STATE.NONE ? _keyState : _state;\n\n    if (state === STATE.ROTATE && !scope.noRotate) {\n      _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\n\n      _movePrev.copy(_moveCurr);\n    } else if (state === STATE.ZOOM && !scope.noZoom) {\n      _zoomStart.copy(getMouseOnScreen(event.pageX, event.pageY));\n\n      _zoomEnd.copy(_zoomStart);\n    } else if (state === STATE.PAN && !scope.noPan) {\n      _panStart.copy(getMouseOnScreen(event.pageX, event.pageY));\n\n      _panEnd.copy(_panStart);\n    }\n\n    scope.domElement.ownerDocument.addEventListener('pointermove', onPointerMove, false);\n    scope.domElement.ownerDocument.addEventListener('pointerup', onPointerUp, false);\n    scope.dispatchEvent(startEvent);\n  }\n\n  function onMouseMove(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n    var state = _keyState !== STATE.NONE ? _keyState : _state;\n\n    if (state === STATE.ROTATE && !scope.noRotate) {\n      _movePrev.copy(_moveCurr);\n\n      _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\n    } else if (state === STATE.ZOOM && !scope.noZoom) {\n      _zoomEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\n    } else if (state === STATE.PAN && !scope.noPan) {\n      _panEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\n    }\n  }\n\n  function onMouseUp(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n    _state = STATE.NONE;\n    scope.domElement.ownerDocument.removeEventListener('pointermove', onPointerMove);\n    scope.domElement.ownerDocument.removeEventListener('pointerup', onPointerUp);\n    scope.dispatchEvent(endEvent);\n  }\n\n  function mousewheel(event) {\n    if (scope.enabled === false) return;\n    if (scope.noZoom === true) return;\n    event.preventDefault();\n    event.stopPropagation();\n\n    switch (event.deltaMode) {\n      case 2:\n        // Zoom in pages\n        _zoomStart.y -= event.deltaY * 0.025;\n        break;\n\n      case 1:\n        // Zoom in lines\n        _zoomStart.y -= event.deltaY * 0.01;\n        break;\n\n      default:\n        // undefined, 0, assume pixels\n        _zoomStart.y -= event.deltaY * 0.00025;\n        break;\n    }\n\n    scope.dispatchEvent(startEvent);\n    scope.dispatchEvent(endEvent);\n  }\n\n  function touchstart(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n\n    switch (event.touches.length) {\n      case 1:\n        _state = STATE.TOUCH_ROTATE;\n\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n\n        _movePrev.copy(_moveCurr);\n\n        break;\n\n      default:\n        // 2 or more\n        _state = STATE.TOUCH_ZOOM_PAN;\n        var dx = event.touches[0].pageX - event.touches[1].pageX;\n        var dy = event.touches[0].pageY - event.touches[1].pageY;\n        _touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt(dx * dx + dy * dy);\n        var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n        var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n\n        _panStart.copy(getMouseOnScreen(x, y));\n\n        _panEnd.copy(_panStart);\n\n        break;\n    }\n\n    scope.dispatchEvent(startEvent);\n  }\n\n  function touchmove(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n\n    switch (event.touches.length) {\n      case 1:\n        _movePrev.copy(_moveCurr);\n\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n\n        break;\n\n      default:\n        // 2 or more\n        var dx = event.touches[0].pageX - event.touches[1].pageX;\n        var dy = event.touches[0].pageY - event.touches[1].pageY;\n        _touchZoomDistanceEnd = Math.sqrt(dx * dx + dy * dy);\n        var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n        var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n\n        _panEnd.copy(getMouseOnScreen(x, y));\n\n        break;\n    }\n  }\n\n  function touchend(event) {\n    if (scope.enabled === false) return;\n\n    switch (event.touches.length) {\n      case 0:\n        _state = STATE.NONE;\n        break;\n\n      case 1:\n        _state = STATE.TOUCH_ROTATE;\n\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n\n        _movePrev.copy(_moveCurr);\n\n        break;\n    }\n\n    scope.dispatchEvent(endEvent);\n  }\n\n  function contextmenu(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n  }\n\n  this.dispose = function () {\n    scope.domElement.removeEventListener('contextmenu', contextmenu, false);\n    scope.domElement.removeEventListener('pointerdown', onPointerDown, false);\n    scope.domElement.removeEventListener('wheel', mousewheel, false);\n    scope.domElement.removeEventListener('touchstart', touchstart, false);\n    scope.domElement.removeEventListener('touchend', touchend, false);\n    scope.domElement.removeEventListener('touchmove', touchmove, false);\n    scope.domElement.ownerDocument.removeEventListener('pointermove', onPointerMove, false);\n    scope.domElement.ownerDocument.removeEventListener('pointerup', onPointerUp, false);\n    window.removeEventListener('keydown', keydown, false);\n    window.removeEventListener('keyup', keyup, false);\n  };\n\n  this.domElement.addEventListener('contextmenu', contextmenu, false);\n  this.domElement.addEventListener('pointerdown', onPointerDown, false);\n  this.domElement.addEventListener('wheel', mousewheel, false);\n  this.domElement.addEventListener('touchstart', touchstart, false);\n  this.domElement.addEventListener('touchend', touchend, false);\n  this.domElement.addEventListener('touchmove', touchmove, false);\n  this.domElement.ownerDocument.addEventListener('pointermove', onPointerMove, false);\n  this.domElement.ownerDocument.addEventListener('pointerup', onPointerUp, false);\n  window.addEventListener('keydown', keydown, false);\n  window.addEventListener('keyup', keyup, false);\n  this.handleResize(); // force an update at start\n\n  this.update();\n};\n\nTrackballControls.prototype = Object.create(EventDispatcher.prototype);\nTrackballControls.prototype.constructor = TrackballControls;\nexport { TrackballControls };","map":{"version":3,"sources":["/home/rodrigo/Dropbox/Projetos/rodrigoKulb/minecraft-react/node_modules/three/examples/jsm/controls/TrackballControls.js"],"names":["EventDispatcher","MOUSE","Quaternion","Vector2","Vector3","TrackballControls","object","domElement","undefined","console","warn","document","error","scope","STATE","NONE","ROTATE","ZOOM","PAN","TOUCH_ROTATE","TOUCH_ZOOM_PAN","enabled","screen","left","top","width","height","rotateSpeed","zoomSpeed","panSpeed","noRotate","noZoom","noPan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","Infinity","keys","mouseButtons","LEFT","MIDDLE","RIGHT","target","EPS","lastPosition","lastZoom","_state","_keyState","_eye","_movePrev","_moveCurr","_lastAxis","_lastAngle","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","target0","clone","position0","position","up0","up","zoom0","zoom","changeEvent","type","startEvent","endEvent","handleResize","box","getBoundingClientRect","d","ownerDocument","documentElement","window","pageXOffset","clientLeft","pageYOffset","clientTop","getMouseOnScreen","vector","pageX","pageY","set","getMouseOnCircle","rotateCamera","axis","quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","angle","x","y","length","copy","sub","normalize","crossVectors","setLength","add","setFromAxisAngle","applyQuaternion","Math","sqrt","zoomCamera","factor","isPerspectiveCamera","multiplyScalar","isOrthographicCamera","updateProjectionMatrix","panCamera","mouseChange","objectUp","pan","lengthSq","scale_x","right","clientWidth","scale_y","bottom","cross","subVectors","checkDistances","addVectors","update","lookAt","distanceToSquared","dispatchEvent","reset","onPointerDown","event","pointerType","onMouseDown","onPointerMove","onMouseMove","onPointerUp","onMouseUp","keydown","removeEventListener","keyCode","keyup","addEventListener","preventDefault","stopPropagation","button","state","mousewheel","deltaMode","deltaY","touchstart","touches","dx","dy","touchmove","touchend","contextmenu","dispose","prototype","Object","create","constructor"],"mappings":"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","sourcesContent":["import {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tVector2,\n\tVector3\n} from \"../../../build/three.module.js\";\n\nvar TrackballControls = function ( object, domElement ) {\n\n\tif ( domElement === undefined ) console.warn( 'THREE.TrackballControls: The second parameter \"domElement\" is now mandatory.' );\n\tif ( domElement === document ) console.error( 'THREE.TrackballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\n\n\tvar scope = this;\n\tvar STATE = { NONE: - 1, ROTATE: 0, ZOOM: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_ZOOM_PAN: 4 };\n\n\tthis.object = object;\n\tthis.domElement = domElement;\n\n\t// API\n\n\tthis.enabled = true;\n\n\tthis.screen = { left: 0, top: 0, width: 0, height: 0 };\n\n\tthis.rotateSpeed = 1.0;\n\tthis.zoomSpeed = 1.2;\n\tthis.panSpeed = 0.3;\n\n\tthis.noRotate = false;\n\tthis.noZoom = false;\n\tthis.noPan = false;\n\n\tthis.staticMoving = false;\n\tthis.dynamicDampingFactor = 0.2;\n\n\tthis.minDistance = 0;\n\tthis.maxDistance = Infinity;\n\n\tthis.keys = [ 65 /*A*/, 83 /*S*/, 68 /*D*/ ];\n\n\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.ZOOM, RIGHT: MOUSE.PAN };\n\n\t// internals\n\n\tthis.target = new Vector3();\n\n\tvar EPS = 0.000001;\n\n\tvar lastPosition = new Vector3();\n\tvar lastZoom = 1;\n\n\tvar _state = STATE.NONE,\n\t\t_keyState = STATE.NONE,\n\n\t\t_eye = new Vector3(),\n\n\t\t_movePrev = new Vector2(),\n\t\t_moveCurr = new Vector2(),\n\n\t\t_lastAxis = new Vector3(),\n\t\t_lastAngle = 0,\n\n\t\t_zoomStart = new Vector2(),\n\t\t_zoomEnd = new Vector2(),\n\n\t\t_touchZoomDistanceStart = 0,\n\t\t_touchZoomDistanceEnd = 0,\n\n\t\t_panStart = new Vector2(),\n\t\t_panEnd = new Vector2();\n\n\t// for reset\n\n\tthis.target0 = this.target.clone();\n\tthis.position0 = this.object.position.clone();\n\tthis.up0 = this.object.up.clone();\n\tthis.zoom0 = this.object.zoom;\n\n\t// events\n\n\tvar changeEvent = { type: 'change' };\n\tvar startEvent = { type: 'start' };\n\tvar endEvent = { type: 'end' };\n\n\n\t// methods\n\n\tthis.handleResize = function () {\n\n\t\tvar box = scope.domElement.getBoundingClientRect();\n\t\t// adjustments come from similar code in the jquery offset() function\n\t\tvar d = scope.domElement.ownerDocument.documentElement;\n\t\tscope.screen.left = box.left + window.pageXOffset - d.clientLeft;\n\t\tscope.screen.top = box.top + window.pageYOffset - d.clientTop;\n\t\tscope.screen.width = box.width;\n\t\tscope.screen.height = box.height;\n\n\t};\n\n\tvar getMouseOnScreen = ( function () {\n\n\t\tvar vector = new Vector2();\n\n\t\treturn function getMouseOnScreen( pageX, pageY ) {\n\n\t\t\tvector.set(\n\t\t\t\t( pageX - scope.screen.left ) / scope.screen.width,\n\t\t\t\t( pageY - scope.screen.top ) / scope.screen.height\n\t\t\t);\n\n\t\t\treturn vector;\n\n\t\t};\n\n\t}() );\n\n\tvar getMouseOnCircle = ( function () {\n\n\t\tvar vector = new Vector2();\n\n\t\treturn function getMouseOnCircle( pageX, pageY ) {\n\n\t\t\tvector.set(\n\t\t\t\t( ( pageX - scope.screen.width * 0.5 - scope.screen.left ) / ( scope.screen.width * 0.5 ) ),\n\t\t\t\t( ( scope.screen.height + 2 * ( scope.screen.top - pageY ) ) / scope.screen.width ) // screen.width intentional\n\t\t\t);\n\n\t\t\treturn vector;\n\n\t\t};\n\n\t}() );\n\n\tthis.rotateCamera = ( function () {\n\n\t\tvar axis = new Vector3(),\n\t\t\tquaternion = new Quaternion(),\n\t\t\teyeDirection = new Vector3(),\n\t\t\tobjectUpDirection = new Vector3(),\n\t\t\tobjectSidewaysDirection = new Vector3(),\n\t\t\tmoveDirection = new Vector3(),\n\t\t\tangle;\n\n\t\treturn function rotateCamera() {\n\n\t\t\tmoveDirection.set( _moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0 );\n\t\t\tangle = moveDirection.length();\n\n\t\t\tif ( angle ) {\n\n\t\t\t\t_eye.copy( scope.object.position ).sub( scope.target );\n\n\t\t\t\teyeDirection.copy( _eye ).normalize();\n\t\t\t\tobjectUpDirection.copy( scope.object.up ).normalize();\n\t\t\t\tobjectSidewaysDirection.crossVectors( objectUpDirection, eyeDirection ).normalize();\n\n\t\t\t\tobjectUpDirection.setLength( _moveCurr.y - _movePrev.y );\n\t\t\t\tobjectSidewaysDirection.setLength( _moveCurr.x - _movePrev.x );\n\n\t\t\t\tmoveDirection.copy( objectUpDirection.add( objectSidewaysDirection ) );\n\n\t\t\t\taxis.crossVectors( moveDirection, _eye ).normalize();\n\n\t\t\t\tangle *= scope.rotateSpeed;\n\t\t\t\tquaternion.setFromAxisAngle( axis, angle );\n\n\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\tscope.object.up.applyQuaternion( quaternion );\n\n\t\t\t\t_lastAxis.copy( axis );\n\t\t\t\t_lastAngle = angle;\n\n\t\t\t} else if ( ! scope.staticMoving && _lastAngle ) {\n\n\t\t\t\t_lastAngle *= Math.sqrt( 1.0 - scope.dynamicDampingFactor );\n\t\t\t\t_eye.copy( scope.object.position ).sub( scope.target );\n\t\t\t\tquaternion.setFromAxisAngle( _lastAxis, _lastAngle );\n\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\tscope.object.up.applyQuaternion( quaternion );\n\n\t\t\t}\n\n\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t};\n\n\t}() );\n\n\n\tthis.zoomCamera = function () {\n\n\t\tvar factor;\n\n\t\tif ( _state === STATE.TOUCH_ZOOM_PAN ) {\n\n\t\t\tfactor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\n\t\t\t_touchZoomDistanceStart = _touchZoomDistanceEnd;\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t_eye.multiplyScalar( factor );\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom *= factor;\n\t\t\t\tscope.object.updateProjectionMatrix();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tfactor = 1.0 + ( _zoomEnd.y - _zoomStart.y ) * scope.zoomSpeed;\n\n\t\t\tif ( factor !== 1.0 && factor > 0.0 ) {\n\n\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t_eye.multiplyScalar( factor );\n\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\tscope.object.zoom /= factor;\n\t\t\t\t\tscope.object.updateProjectionMatrix();\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( scope.staticMoving ) {\n\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t} else {\n\n\t\t\t\t_zoomStart.y += ( _zoomEnd.y - _zoomStart.y ) * this.dynamicDampingFactor;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tthis.panCamera = ( function () {\n\n\t\tvar mouseChange = new Vector2(),\n\t\t\tobjectUp = new Vector3(),\n\t\t\tpan = new Vector3();\n\n\t\treturn function panCamera() {\n\n\t\t\tmouseChange.copy( _panEnd ).sub( _panStart );\n\n\t\t\tif ( mouseChange.lengthSq() ) {\n\n\t\t\t\tif ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\tvar scale_x = ( scope.object.right - scope.object.left ) / scope.object.zoom / scope.domElement.clientWidth;\n\t\t\t\t\tvar scale_y = ( scope.object.top - scope.object.bottom ) / scope.object.zoom / scope.domElement.clientWidth;\n\n\t\t\t\t\tmouseChange.x *= scale_x;\n\t\t\t\t\tmouseChange.y *= scale_y;\n\n\t\t\t\t}\n\n\t\t\t\tmouseChange.multiplyScalar( _eye.length() * scope.panSpeed );\n\n\t\t\t\tpan.copy( _eye ).cross( scope.object.up ).setLength( mouseChange.x );\n\t\t\t\tpan.add( objectUp.copy( scope.object.up ).setLength( mouseChange.y ) );\n\n\t\t\t\tscope.object.position.add( pan );\n\t\t\t\tscope.target.add( pan );\n\n\t\t\t\tif ( scope.staticMoving ) {\n\n\t\t\t\t\t_panStart.copy( _panEnd );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_panStart.add( mouseChange.subVectors( _panEnd, _panStart ).multiplyScalar( scope.dynamicDampingFactor ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t}() );\n\n\tthis.checkDistances = function () {\n\n\t\tif ( ! scope.noZoom || ! scope.noPan ) {\n\n\t\t\tif ( _eye.lengthSq() > scope.maxDistance * scope.maxDistance ) {\n\n\t\t\t\tscope.object.position.addVectors( scope.target, _eye.setLength( scope.maxDistance ) );\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t}\n\n\t\t\tif ( _eye.lengthSq() < scope.minDistance * scope.minDistance ) {\n\n\t\t\t\tscope.object.position.addVectors( scope.target, _eye.setLength( scope.minDistance ) );\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tthis.update = function () {\n\n\t\t_eye.subVectors( scope.object.position, scope.target );\n\n\t\tif ( ! scope.noRotate ) {\n\n\t\t\tscope.rotateCamera();\n\n\t\t}\n\n\t\tif ( ! scope.noZoom ) {\n\n\t\t\tscope.zoomCamera();\n\n\t\t}\n\n\t\tif ( ! scope.noPan ) {\n\n\t\t\tscope.panCamera();\n\n\t\t}\n\n\t\tscope.object.position.addVectors( scope.target, _eye );\n\n\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\tscope.checkDistances();\n\n\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\tif ( lastPosition.distanceToSquared( scope.object.position ) > EPS ) {\n\n\t\t\t\tscope.dispatchEvent( changeEvent );\n\n\t\t\t\tlastPosition.copy( scope.object.position );\n\n\t\t\t}\n\n\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\tif ( lastPosition.distanceToSquared( scope.object.position ) > EPS || lastZoom !== scope.object.zoom ) {\n\n\t\t\t\tscope.dispatchEvent( changeEvent );\n\n\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\tlastZoom = scope.object.zoom;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t}\n\n\t};\n\n\tthis.reset = function () {\n\n\t\t_state = STATE.NONE;\n\t\t_keyState = STATE.NONE;\n\n\t\tscope.target.copy( scope.target0 );\n\t\tscope.object.position.copy( scope.position0 );\n\t\tscope.object.up.copy( scope.up0 );\n\t\tscope.object.zoom = scope.zoom0;\n\n\t\tscope.object.updateProjectionMatrix();\n\n\t\t_eye.subVectors( scope.object.position, scope.target );\n\n\t\tscope.object.lookAt( scope.target );\n\n\t\tscope.dispatchEvent( changeEvent );\n\n\t\tlastPosition.copy( scope.object.position );\n\t\tlastZoom = scope.object.zoom;\n\n\t};\n\n\t// listeners\n\n\tfunction onPointerDown( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tswitch ( event.pointerType ) {\n\n\t\t\tcase 'mouse':\n\t\t\t\tonMouseDown( event );\n\t\t\t\tbreak;\n\n\t\t\t// TODO touch\n\n\t\t}\n\n\t}\n\n\tfunction onPointerMove( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tswitch ( event.pointerType ) {\n\n\t\t\tcase 'mouse':\n\t\t\t\tonMouseMove( event );\n\t\t\t\tbreak;\n\n\t\t\t// TODO touch\n\n\t\t}\n\n\t}\n\n\tfunction onPointerUp( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tswitch ( event.pointerType ) {\n\n\t\t\tcase 'mouse':\n\t\t\t\tonMouseUp( event );\n\t\t\t\tbreak;\n\n\t\t\t// TODO touch\n\n\t\t}\n\n\t}\n\n\tfunction keydown( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\twindow.removeEventListener( 'keydown', keydown );\n\n\t\tif ( _keyState !== STATE.NONE ) {\n\n\t\t\treturn;\n\n\t\t} else if ( event.keyCode === scope.keys[ STATE.ROTATE ] && ! scope.noRotate ) {\n\n\t\t\t_keyState = STATE.ROTATE;\n\n\t\t} else if ( event.keyCode === scope.keys[ STATE.ZOOM ] && ! scope.noZoom ) {\n\n\t\t\t_keyState = STATE.ZOOM;\n\n\t\t} else if ( event.keyCode === scope.keys[ STATE.PAN ] && ! scope.noPan ) {\n\n\t\t\t_keyState = STATE.PAN;\n\n\t\t}\n\n\t}\n\n\tfunction keyup() {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\t_keyState = STATE.NONE;\n\n\t\twindow.addEventListener( 'keydown', keydown, false );\n\n\t}\n\n\tfunction onMouseDown( event ) {\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif ( _state === STATE.NONE ) {\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase scope.mouseButtons.LEFT:\n\t\t\t\t\t_state = STATE.ROTATE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.mouseButtons.MIDDLE:\n\t\t\t\t\t_state = STATE.ZOOM;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.mouseButtons.RIGHT:\n\t\t\t\t\t_state = STATE.PAN;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t_state = STATE.NONE;\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\n\n\t\tif ( state === STATE.ROTATE && ! scope.noRotate ) {\n\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t} else if ( state === STATE.ZOOM && ! scope.noZoom ) {\n\n\t\t\t_zoomStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t_zoomEnd.copy( _zoomStart );\n\n\t\t} else if ( state === STATE.PAN && ! scope.noPan ) {\n\n\t\t\t_panStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t_panEnd.copy( _panStart );\n\n\t\t}\n\n\t\tscope.domElement.ownerDocument.addEventListener( 'pointermove', onPointerMove, false );\n\t\tscope.domElement.ownerDocument.addEventListener( 'pointerup', onPointerUp, false );\n\n\t\tscope.dispatchEvent( startEvent );\n\n\t}\n\n\tfunction onMouseMove( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tvar state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\n\n\t\tif ( state === STATE.ROTATE && ! scope.noRotate ) {\n\n\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\n\t\t} else if ( state === STATE.ZOOM && ! scope.noZoom ) {\n\n\t\t\t_zoomEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t} else if ( state === STATE.PAN && ! scope.noPan ) {\n\n\t\t\t_panEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t}\n\n\t}\n\n\tfunction onMouseUp( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\t_state = STATE.NONE;\n\n\t\tscope.domElement.ownerDocument.removeEventListener( 'pointermove', onPointerMove );\n\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerup', onPointerUp );\n\n\t\tscope.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction mousewheel( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tif ( scope.noZoom === true ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswitch ( event.deltaMode ) {\n\n\t\t\tcase 2:\n\t\t\t\t// Zoom in pages\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.025;\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\t// Zoom in lines\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.01;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t// undefined, 0, assume pixels\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.00025;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tscope.dispatchEvent( startEvent );\n\t\tscope.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction touchstart( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\tbreak;\n\n\t\t\tdefault: // 2 or more\n\t\t\t\t_state = STATE.TOUCH_ZOOM_PAN;\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\t_touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\n\t\t\t\t_panStart.copy( getMouseOnScreen( x, y ) );\n\t\t\t\t_panEnd.copy( _panStart );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tscope.dispatchEvent( startEvent );\n\n\t}\n\n\tfunction touchmove( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\tbreak;\n\n\t\t\tdefault: // 2 or more\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\t_touchZoomDistanceEnd = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\n\t\t\t\t_panEnd.copy( getMouseOnScreen( x, y ) );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction touchend( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 0:\n\t\t\t\t_state = STATE.NONE;\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tscope.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction contextmenu( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t}\n\n\tthis.dispose = function () {\n\n\t\tscope.domElement.removeEventListener( 'contextmenu', contextmenu, false );\n\n\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown, false );\n\t\tscope.domElement.removeEventListener( 'wheel', mousewheel, false );\n\n\t\tscope.domElement.removeEventListener( 'touchstart', touchstart, false );\n\t\tscope.domElement.removeEventListener( 'touchend', touchend, false );\n\t\tscope.domElement.removeEventListener( 'touchmove', touchmove, false );\n\n\t\tscope.domElement.ownerDocument.removeEventListener( 'pointermove', onPointerMove, false );\n\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerup', onPointerUp, false );\n\n\t\twindow.removeEventListener( 'keydown', keydown, false );\n\t\twindow.removeEventListener( 'keyup', keyup, false );\n\n\t};\n\n\tthis.domElement.addEventListener( 'contextmenu', contextmenu, false );\n\n\tthis.domElement.addEventListener( 'pointerdown', onPointerDown, false );\n\tthis.domElement.addEventListener( 'wheel', mousewheel, false );\n\n\tthis.domElement.addEventListener( 'touchstart', touchstart, false );\n\tthis.domElement.addEventListener( 'touchend', touchend, false );\n\tthis.domElement.addEventListener( 'touchmove', touchmove, false );\n\n\tthis.domElement.ownerDocument.addEventListener( 'pointermove', onPointerMove, false );\n\tthis.domElement.ownerDocument.addEventListener( 'pointerup', onPointerUp, false );\n\n\twindow.addEventListener( 'keydown', keydown, false );\n\twindow.addEventListener( 'keyup', keyup, false );\n\n\tthis.handleResize();\n\n\t// force an update at start\n\tthis.update();\n\n};\n\nTrackballControls.prototype = Object.create( EventDispatcher.prototype );\nTrackballControls.prototype.constructor = TrackballControls;\n\nexport { TrackballControls };\n"]},"metadata":{},"sourceType":"module"}