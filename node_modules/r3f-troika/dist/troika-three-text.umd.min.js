'use strict';(function(D,A){"object"===typeof exports&&"undefined"!==typeof module?A(exports,require("three"),require("troika-worker-utils"),require("troika-three-utils")):"function"===typeof define&&define.amd?define(["exports","three","troika-worker-utils","troika-three-utils"],A):(D=D||self,A(D.troika_three_text={},D.THREE,D.troika_worker_utils,D.troika_three_utils))})(this,function(D,A,G,ja){function ka(k,g){k=la({},k);k.font=wa(k.font||N.defaultFontURL);k.text=""+k.text;k.sdfGlyphSize=k.sdfGlyphSize||
N.sdfGlyphSize;if(null!=k.colorRanges){var c={};for(d in k.colorRanges)if(k.colorRanges.hasOwnProperty(d)){var a=k.colorRanges[d];"number"!==typeof a&&(a=xa.set(a).getHex());c[d]=a}k.colorRanges=c}Object.freeze(k);c=N.textureWidth;var b=k.sdfGlyphSize;var d=k.font+"@"+b;var e=ma[d];e||(e=ma[d]={sdfTexture:new A.DataTexture(new Uint8Array(b*c),c,b,A.LuminanceFormat,void 0,void 0,void 0,void 0,A.LinearFilter,A.LinearFilter)},e.sdfTexture.font=k.font);ya(k).then(function(a){a.newGlyphSDFs&&(a.newGlyphSDFs.forEach(function(a){var c=
a.textureData;a=a.atlasIndex;for(var d=e.sdfTexture.image;d.data.length<(a+1)*b*b;){var f=new Uint8Array(2*d.data.length);f.set(d.data);d.data=f;d.height*=2}f=d.width/b;for(var g=0;g<b;g++)for(var h=g*b,n=d.width*b*Math.floor(a/f)+a%f*b+g*d.width,m=0;m<b;m++)d.data[n+m]=c[h+m]}),e.sdfTexture.needsUpdate=!0);g(Object.freeze({parameters:k,sdfTexture:e.sdfTexture,sdfGlyphSize:b,sdfMinDistancePercent:.125,glyphBounds:a.glyphBounds,glyphAtlasIndices:a.glyphAtlasIndices,glyphColors:a.glyphColors,caretPositions:a.caretPositions,
caretHeight:a.caretHeight,chunkedBounds:a.chunkedBounds,ascender:a.ascender,descender:a.descender,lineHeight:a.lineHeight,topBaseline:a.topBaseline,totalBounds:a.totalBounds,totalBlockSize:a.totalBlockSize,timings:a.timings}))})}function la(k,g){for(var c in g)g.hasOwnProperty(c)&&(k[c]=g[c]);return k}function wa(k){S||(S="undefined"===typeof document?{}:document.createElement("a"));S.href=k;return S.href}function za(k){var g=na[k];g||(g=na[k]=(new A.PlaneBufferGeometry(1,1,k,k)).translate(.5,.5,
0));return g}function T(k,g,c,a){var b=k.getAttribute(g);c?b&&b.array.length===c.length?(b.array.set(c),b.needsUpdate=!0):(k.setAttribute(g,new A.InstancedBufferAttribute(c,a)),delete k._maxInstanceCount,k.dispose()):b&&k.deleteAttribute(g)}function oa(k,g){k[k.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=g}function pa(k){k=ja.createDerivedMaterial(k,{extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new A.Vector2},uTroikaSDFGlyphSize:{value:0},
uTroikaSDFMinDistancePct:{value:0},uTroikaTotalBounds:{value:new A.Vector4(0,0,0,0)},uTroikaClipRect:{value:new A.Vector4(0,0,0,0)},uTroikaOrient:{value:new A.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaSDFTextureUV;\nvarying vec2 vTroikaGlyphUV;\nvarying vec3 vTroikaGlyphColor;\n",
vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nvec4 clippedBounds = vec4(\n  clamp(bounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(bounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\nvTroikaGlyphUV = clippedXY.xy;\n\nfloat cols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvTroikaSDFTextureUV = vec2(\n  mod(aTroikaGlyphIndex, cols) + clippedXY.x,\n  floor(aTroikaGlyphIndex / cols) + clippedXY.y\n) * uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = vec2(\n  (position.x - uTroikaTotalBounds.x) / (uTroikaTotalBounds.z - uTroikaTotalBounds.x),\n  (position.y - uTroikaTotalBounds.y) / (uTroikaTotalBounds.w - uTroikaTotalBounds.y)\n);\n\nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n",
fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform float uTroikaSDFMinDistancePct;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaSDFTextureUV;\nvarying vec2 vTroikaGlyphUV;\n\nfloat troikaGetTextAlpha() {\n  float troikaSDFValue = texture2D(uTroikaSDFTexture, vTroikaSDFTextureUV).r;\n  \n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(0.5, troikaSDFValue);\n  #else\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  float aaDist = min(\n    0.5,\n    0.5 * min(\n      fwidth(vTroikaGlyphUV.x),\n      fwidth(vTroikaGlyphUV.y)\n    )\n  ) / uTroikaSDFMinDistancePct;\n  #else\n  float aaDist = 0.01;\n  #endif\n  \n  float alpha = uTroikaSDFDebug ? troikaSDFValue : smoothstep(\n    0.5 - aaDist,\n    0.5 + aaDist,\n    troikaSDFValue\n  );\n  #endif\n  \n  return alpha;\n}\n",
fragmentColorTransform:"\nfloat troikaAlphaMult = troikaGetTextAlpha();\nif (troikaAlphaMult == 0.0) {\n  discard;\n} else {\n  gl_FragColor.a *= troikaAlphaMult;\n}\n",customRewriter:function(g){var c=g.vertexShader;g=g.fragmentShader;var a=/\buniform\s+vec3\s+diffuse\b/;a.test(g)&&(g=g.replace(a,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),a.test(c)||(c=c.replace(ja.voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n")));
return{vertexShader:c,fragmentShader:g}}});k.transparent=!0;Object.defineProperties(k,{isTroikaTextMaterial:{value:!0},shadowSide:{get:function(){return this.side},set:function(){}}});return k}function Aa(k){var g=qa.get(k);if(!g){var c=k.caretPositions,a=k.caretHeight;g=new Map;for(var b=0;b<c.length;b+=3){var d=c[b+2],e=g.get(d);e||g.set(d,e=[]);e.push({x:c[b],y:d,height:a,charIndex:b/3});b+3>=c.length&&e.push({x:c[b+1],y:d,height:a,charIndex:b/3+1})}}qa.set(k,g);return g}var U=G.defineWorkerModule({name:"Typr Font Parser",
dependencies:[function(){var k=self,g={parse:function(c){var a=g._bin;c=new Uint8Array(c);if("ttcf"==a.readASCII(c,0,4)){var b=4;a.readUshort(c,b);b+=2;a.readUshort(c,b);b+=2;var d=a.readUint(c,b);b+=4;for(var e=[],f=0;f<d;f++){var h=a.readUint(c,b);b+=4;e.push(g._readFont(c,h))}return e}return[g._readFont(c,0)]},_readFont:function(c,a){var b=g._bin,d=a;b.readFixed(c,a);a+=4;var e=b.readUshort(c,a);a+=2;b.readUshort(c,a);a+=2;b.readUshort(c,a);a+=2;b.readUshort(c,a);a+=2;var f="cmap;head;hhea;maxp;hmtx;name;OS/2;post;loca;glyf;kern;CFF ;GPOS;GSUB;SVG ".split(";");
d={_data:c,_offset:d};for(var h={},l=0;l<e;l++){var q=b.readASCII(c,a,4);a+=4;b.readUint(c,a);a+=4;var r=b.readUint(c,a);a+=4;var k=b.readUint(c,a);a+=4;h[q]={offset:r,length:k}}for(l=0;l<f.length;l++)a=f[l],h[a]&&(d[a.trim()]=g[a.trim()].parse(c,h[a].offset,h[a].length,d));return d},_tabOffset:function(c,a,b){var d=g._bin,e=d.readUshort(c,b+4);b+=12;for(var f=0;f<e;f++){var h=d.readASCII(c,b,4);b+=4;d.readUint(c,b);b+=4;var l=d.readUint(c,b);b+=4;d.readUint(c,b);b+=4;if(h==a)return l}return 0}};
g._bin={readFixed:function(c,a){return(c[a]<<8|c[a+1])+(c[a+2]<<8|c[a+3])/65540},readF2dot14:function(c,a){return g._bin.readShort(c,a)/16384},readInt:function(c,a){var b=g._bin.t.uint8;b[0]=c[a+3];b[1]=c[a+2];b[2]=c[a+1];b[3]=c[a];return g._bin.t.int32[0]},readInt8:function(c,a){g._bin.t.uint8[0]=c[a];return g._bin.t.int8[0]},readShort:function(c,a){var b=g._bin.t.uint8;b[1]=c[a];b[0]=c[a+1];return g._bin.t.int16[0]},readUshort:function(c,a){return c[a]<<8|c[a+1]},readUshorts:function(c,a,b){for(var d=
[],e=0;e<b;e++)d.push(g._bin.readUshort(c,a+2*e));return d},readUint:function(c,a){var b=g._bin.t.uint8;b[3]=c[a];b[2]=c[a+1];b[1]=c[a+2];b[0]=c[a+3];return g._bin.t.uint32[0]},readUint64:function(c,a){return 4294967296*g._bin.readUint(c,a)+g._bin.readUint(c,a+4)},readASCII:function(c,a,b){for(var d="",e=0;e<b;e++)d+=String.fromCharCode(c[a+e]);return d},readUnicode:function(c,a,b){for(var d="",e=0;e<b;e++){var f=c[a++]<<8|c[a++];d+=String.fromCharCode(f)}return d},_tdec:k.TextDecoder?new k.TextDecoder:
null,readUTF8:function(c,a,b){var d=g._bin._tdec;return d&&0==a&&b==c.length?d.decode(c):g._bin.readASCII(c,a,b)},readBytes:function(c,a,b){for(var d=[],e=0;e<b;e++)d.push(c[a+e]);return d},readASCIIArray:function(c,a,b){for(var d=[],e=0;e<b;e++)d.push(String.fromCharCode(c[a+e]));return d}};g._bin.t={buff:new ArrayBuffer(8)};g._bin.t.int8=new Int8Array(g._bin.t.buff);g._bin.t.uint8=new Uint8Array(g._bin.t.buff);g._bin.t.int16=new Int16Array(g._bin.t.buff);g._bin.t.uint16=new Uint16Array(g._bin.t.buff);
g._bin.t.int32=new Int32Array(g._bin.t.buff);g._bin.t.uint32=new Uint32Array(g._bin.t.buff);g._lctf={};g._lctf.parse=function(c,a,b,d,e){var f=g._bin;b={};d=a;f.readFixed(c,a);a+=4;var h=f.readUshort(c,a);a+=2;var l=f.readUshort(c,a);a=f.readUshort(c,a+2);b.scriptList=g._lctf.readScriptList(c,d+h);b.featureList=g._lctf.readFeatureList(c,d+l);b.lookupList=g._lctf.readLookupList(c,d+a,e);return b};g._lctf.readLookupList=function(c,a,b){var d=g._bin,e=a,f=[],h=d.readUshort(c,a);a+=2;for(var l=0;l<h;l++){var q=
d.readUshort(c,a);a+=2;q=g._lctf.readLookupTable(c,e+q,b);f.push(q)}return f};g._lctf.readLookupTable=function(c,a,b){var d=g._bin,e=a,f={tabs:[]};f.ltype=d.readUshort(c,a);a+=2;f.flag=d.readUshort(c,a);a+=2;var h=d.readUshort(c,a);a+=2;for(var l=0;l<h;l++){var q=d.readUshort(c,a);a+=2;q=b(c,f.ltype,e+q);f.tabs.push(q)}return f};g._lctf.numOfOnes=function(c){for(var a=0,b=0;32>b;b++)0!=(c>>>b&1)&&a++;return a};g._lctf.readClassDef=function(c,a){var b=g._bin,d=[],e=b.readUshort(c,a);a+=2;if(1==e){var f=
b.readUshort(c,a);a+=2;var h=b.readUshort(c,a);a+=2;for(var l=0;l<h;l++)d.push(f+l),d.push(f+l),d.push(b.readUshort(c,a)),a+=2}if(2==e)for(e=b.readUshort(c,a),a+=2,l=0;l<e;l++)d.push(b.readUshort(c,a)),a+=2,d.push(b.readUshort(c,a)),a+=2,d.push(b.readUshort(c,a)),a+=2;return d};g._lctf.getInterval=function(c,a){for(var b=0;b<c.length;b+=3){var d=c[b+1];if(c[b]<=a&&a<=d)return b}return-1};g._lctf.readCoverage=function(c,a){var b=g._bin,d={};d.fmt=b.readUshort(c,a);a+=2;var e=b.readUshort(c,a);a+=2;
1==d.fmt&&(d.tab=b.readUshorts(c,a,e));2==d.fmt&&(d.tab=b.readUshorts(c,a,3*e));return d};g._lctf.coverageIndex=function(c,a){var b=c.tab;return 1==c.fmt?b.indexOf(a):2==c.fmt&&(c=g._lctf.getInterval(b,a),-1!=c)?b[c+2]+(a-b[c]):-1};g._lctf.readFeatureList=function(c,a){var b=g._bin,d=a,e=[],f=b.readUshort(c,a);a+=2;for(var h=0;h<f;h++){var l=b.readASCII(c,a,4);a+=4;var q=b.readUshort(c,a);a+=2;e.push({tag:l.trim(),tab:g._lctf.readFeatureTable(c,d+q)})}return e};g._lctf.readFeatureTable=function(c,
a){var b=g._bin;b.readUshort(c,a);a+=2;var d=b.readUshort(c,a);a+=2;for(var e=[],f=0;f<d;f++)e.push(b.readUshort(c,a+2*f));return e};g._lctf.readScriptList=function(c,a){var b=g._bin,d=a,e={},f=b.readUshort(c,a);a+=2;for(var h=0;h<f;h++){var l=b.readASCII(c,a,4);a+=4;var q=b.readUshort(c,a);a+=2;e[l.trim()]=g._lctf.readScriptTable(c,d+q)}return e};g._lctf.readScriptTable=function(c,a){var b=g._bin,d=a,e={},f=b.readUshort(c,a);a+=2;e.default=g._lctf.readLangSysTable(c,d+f);f=b.readUshort(c,a);a+=2;
for(var h=0;h<f;h++){var l=b.readASCII(c,a,4);a+=4;var q=b.readUshort(c,a);a+=2;e[l.trim()]=g._lctf.readLangSysTable(c,d+q)}return e};g._lctf.readLangSysTable=function(c,a){var b=g._bin,d={};b.readUshort(c,a);a+=2;d.reqFeature=b.readUshort(c,a);a+=2;var e=b.readUshort(c,a);d.features=b.readUshorts(c,a+2,e);return d};g.CFF={};g.CFF.parse=function(c,a,b){var d=g._bin;c=new Uint8Array(c.buffer,a,b);a=0;a++;a++;a++;a++;var e=[];a=g.CFF.readIndex(c,a,e);var f=[];for(b=0;b<e.length-1;b++)f.push(d.readASCII(c,
a+e[b],e[b+1]-e[b]));a+=e[e.length-1];e=[];a=g.CFF.readIndex(c,a,e);f=[];for(b=0;b<e.length-1;b++)f.push(g.CFF.readDict(c,a+e[b],a+e[b+1]));a+=e[e.length-1];e=f[0];var h=[];a=g.CFF.readIndex(c,a,h);f=[];for(b=0;b<h.length-1;b++)f.push(d.readASCII(c,a+h[b],h[b+1]-h[b]));a+=h[h.length-1];g.CFF.readSubrs(c,a,e);if(e.CharStrings){a=e.CharStrings;h=[];a=g.CFF.readIndex(c,a,h);var l=[];for(b=0;b<h.length-1;b++)l.push(d.readBytes(c,a+h[b],h[b+1]-h[b]));e.CharStrings=l}if(e.ROS){a=e.FDArray;h=[];a=g.CFF.readIndex(c,
a,h);e.FDArray=[];for(b=0;b<h.length-1;b++)l=g.CFF.readDict(c,a+h[b],a+h[b+1]),g.CFF._readFDict(c,l,f),e.FDArray.push(l);a=e.FDSelect;e.FDSelect=[];b=c[a];a++;if(3==b)for(h=d.readUshort(c,a),a+=2,b=0;b<h+1;b++)e.FDSelect.push(d.readUshort(c,a),c[a+2]),a+=3;else throw b;}e.Encoding&&(e.Encoding=g.CFF.readEncoding(c,e.Encoding,e.CharStrings.length));e.charset&&(e.charset=g.CFF.readCharset(c,e.charset,e.CharStrings.length));g.CFF._readFDict(c,e,f);return e};g.CFF._readFDict=function(c,a,b){if(a.Private){var d=
a.Private[1];a.Private=g.CFF.readDict(c,d,d+a.Private[0]);a.Private.Subrs&&g.CFF.readSubrs(c,d+a.Private.Subrs,a.Private)}for(var e in a)-1!="FamilyName FontName FullName Notice version Copyright".split(" ").indexOf(e)&&(a[e]=b[a[e]-426+35])};g.CFF.readSubrs=function(c,a,b){var d=g._bin,e=[];a=g.CFF.readIndex(c,a,e);var f=e.length;b.Bias=1240>f?107:33900>f?1131:32768;b.Subrs=[];for(f=0;f<e.length-1;f++)b.Subrs.push(d.readBytes(c,a+e[f],e[f+1]-e[f]))};g.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,
127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0];g.CFF.glyphByUnicode=function(c,a){for(var b=0;b<c.charset.length;b++)if(c.charset[b]==a)return b;return-1};g.CFF.glyphBySE=function(c,a){return 0>a||255<a?-1:g.CFF.glyphByUnicode(c,g.CFF.tableSE[a])};g.CFF.readEncoding=function(c,a,b){b=[".notdef"];var d=c[a];a++;if(0==d){d=c[a];a++;for(var e=0;e<d;e++)b.push(c[a+e])}else throw"error: unknown encoding format: "+
d;return b};g.CFF.readCharset=function(c,a,b){var d=g._bin,e=[".notdef"],f=c[a];a++;if(0==f)for(var h=0;h<b;h++){var l=d.readUshort(c,a);a+=2;e.push(l)}else if(1==f||2==f)for(;e.length<b;){l=d.readUshort(c,a);a+=2;if(1==f){var q=c[a];a++}else q=d.readUshort(c,a),a+=2;for(h=0;h<=q;h++)e.push(l),l++}else throw"error: format: "+f;return e};g.CFF.readIndex=function(c,a,b){var d=g._bin,e=d.readUshort(c,a)+1;a+=2;var f=c[a];a++;if(1==f)for(var h=0;h<e;h++)b.push(c[a+h]);else if(2==f)for(h=0;h<e;h++)b.push(d.readUshort(c,
a+2*h));else if(3==f)for(h=0;h<e;h++)b.push(d.readUint(c,a+3*h-1)&16777215);else if(1!=e)throw"unsupported offset size: "+f+", count: "+e;return a+e*f-1};g.CFF.getCharString=function(c,a,b){var d=g._bin,e=c[a],f=c[a+1],h=1,l=null,q=null;20>=e&&(l=e,h=1);12==e&&(l=100*e+f,h=2);21<=e&&27>=e&&(l=e,h=1);28==e&&(q=d.readShort(c,a+1),h=3);29<=e&&31>=e&&(l=e,h=1);32<=e&&246>=e&&(q=e-139,h=1);247<=e&&250>=e&&(q=256*(e-247)+f+108,h=2);251<=e&&254>=e&&(q=256*-(e-251)-f-108,h=2);255==e&&(q=d.readInt(c,a+1)/
65535,h=5);b.val=null!=q?q:"o"+l;b.size=h};g.CFF.readCharString=function(c,a,b){b=a+b;for(var d=g._bin,e=[];a<b;){var f=c[a],h=c[a+1],l=1,q=null,r=null;20>=f&&(q=f,l=1);12==f&&(q=100*f+h,l=2);if(19==f||20==f)q=f,l=2;21<=f&&27>=f&&(q=f,l=1);28==f&&(r=d.readShort(c,a+1),l=3);29<=f&&31>=f&&(q=f,l=1);32<=f&&246>=f&&(r=f-139,l=1);247<=f&&250>=f&&(r=256*(f-247)+h+108,l=2);251<=f&&254>=f&&(r=256*-(f-251)-h-108,l=2);255==f&&(r=d.readInt(c,a+1)/65535,l=5);e.push(null!=r?r:"o"+q);a+=l}return e};g.CFF.readDict=
function(c,a,b){for(var d=g._bin,e={},f=[];a<b;){var h=c[a],l=c[a+1],q=1,r=null,k=null;28==h&&(k=d.readShort(c,a+1),q=3);29==h&&(k=d.readInt(c,a+1),q=5);32<=h&&246>=h&&(k=h-139,q=1);247<=h&&250>=h&&(k=256*(h-247)+l+108,q=2);251<=h&&254>=h&&(k=256*-(h-251)-l-108,q=2);if(255==h)throw d.readInt(c,a+1),"unknown number";if(30==h){k=[];for(q=1;;){var p=c[a+q];q++;var n=p>>4;p&=15;15!=n&&k.push(n);15!=p&&k.push(p);if(15==p)break}n="";p=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"];for(var m=
0;m<k.length;m++)n+=p[k[m]];k=parseFloat(n)}21>=h&&(q="version Notice FullName FamilyName Weight FontBBox BlueValues OtherBlues FamilyBlues FamilyOtherBlues StdHW StdVW escape UniqueID XUID charset Encoding CharStrings Private Subrs defaultWidthX nominalWidthX".split(" "),r=q[h],q=1,12==h&&(q=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",
0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"],r=q[l],q=2));null!=r?(e[r]=1==f.length?f[0]:f,f=[]):f.push(k);a+=q}return e};g.cmap={};g.cmap.parse=function(c,a,b){c=new Uint8Array(c.buffer,a,b);a=0;b=g._bin;var d={};b.readUshort(c,a);a+=2;var e=b.readUshort(c,a);a+=2;var f=[];d.tables=[];for(var h=0;h<e;h++){var l=
b.readUshort(c,a);a+=2;var q=b.readUshort(c,a);a+=2;var r=b.readUint(c,a);a+=4;var k="p"+l+"e"+q,p=f.indexOf(r);if(-1==p){p=d.tables.length;var n;f.push(r);var m=b.readUshort(c,r);0==m?n=g.cmap.parse0(c,r):4==m?n=g.cmap.parse4(c,r):6==m?n=g.cmap.parse6(c,r):12==m?n=g.cmap.parse12(c,r):console.log("unknown format: "+m,l,q,r);d.tables.push(n)}if(null!=d[k])throw"multiple tables for one platform+encoding";d[k]=p}return d};g.cmap.parse0=function(c,a){var b=g._bin,d={};d.format=b.readUshort(c,a);a+=2;
var e=b.readUshort(c,a);a+=2;b.readUshort(c,a);a+=2;d.map=[];for(b=0;b<e-6;b++)d.map.push(c[a+b]);return d};g.cmap.parse4=function(c,a){var b=g._bin,d=a,e={};e.format=b.readUshort(c,a);a+=2;var f=b.readUshort(c,a);a+=2;b.readUshort(c,a);a+=2;var h=b.readUshort(c,a);a+=2;h/=2;e.searchRange=b.readUshort(c,a);a+=2;e.entrySelector=b.readUshort(c,a);a+=2;e.rangeShift=b.readUshort(c,a);a+=2;e.endCount=b.readUshorts(c,a,h);a=a+2*h+2;e.startCount=b.readUshorts(c,a,h);a+=2*h;e.idDelta=[];for(var l=0;l<h;l++)e.idDelta.push(b.readShort(c,
a)),a+=2;e.idRangeOffset=b.readUshorts(c,a,h);a+=2*h;for(e.glyphIdArray=[];a<d+f;)e.glyphIdArray.push(b.readUshort(c,a)),a+=2;return e};g.cmap.parse6=function(c,a){var b=g._bin,d={};d.format=b.readUshort(c,a);a+=2;b.readUshort(c,a);a+=2;b.readUshort(c,a);a+=2;d.firstCode=b.readUshort(c,a);a+=2;var e=b.readUshort(c,a);a+=2;d.glyphIdArray=[];for(var f=0;f<e;f++)d.glyphIdArray.push(b.readUshort(c,a)),a+=2;return d};g.cmap.parse12=function(c,a){var b=g._bin,d={};d.format=b.readUshort(c,a);a=a+2+2;b.readUint(c,
a);a+=4;b.readUint(c,a);a+=4;var e=b.readUint(c,a);a+=4;d.groups=[];for(var f=0;f<e;f++){var h=a+12*f,l=b.readUint(c,h+0),q=b.readUint(c,h+4);h=b.readUint(c,h+8);d.groups.push([l,q,h])}return d};g.glyf={};g.glyf.parse=function(c,a,b,d){c=[];for(a=0;a<d.maxp.numGlyphs;a++)c.push(null);return c};g.glyf._parseGlyf=function(c,a){var b=g._bin,d=c._data,e=g._tabOffset(d,"glyf",c._offset)+c.loca[a];if(c.loca[a]==c.loca[a+1])return null;c={};c.noc=b.readShort(d,e);e+=2;c.xMin=b.readShort(d,e);e+=2;c.yMin=
b.readShort(d,e);e+=2;c.xMax=b.readShort(d,e);e+=2;c.yMax=b.readShort(d,e);e+=2;if(c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(0<c.noc){c.endPts=[];for(a=0;a<c.noc;a++)c.endPts.push(b.readUshort(d,e)),e+=2;a=b.readUshort(d,e);e+=2;if(d.length-e<a)return null;c.instructions=b.readBytes(d,e,a);e+=a;var f=c.endPts[c.noc-1]+1;c.flags=[];for(a=0;a<f;a++){var h=d[e];e++;c.flags.push(h);if(0!=(h&8)){var l=d[e];e++;for(var q=0;q<l;q++)c.flags.push(h),a++}}c.xs=[];for(a=0;a<f;a++)h=0!=(c.flags[a]&2),l=0!=
(c.flags[a]&16),h?(c.xs.push(l?d[e]:-d[e]),e++):l?c.xs.push(0):(c.xs.push(b.readShort(d,e)),e+=2);c.ys=[];for(a=0;a<f;a++)h=0!=(c.flags[a]&4),l=0!=(c.flags[a]&32),h?(c.ys.push(l?d[e]:-d[e]),e++):l?c.ys.push(0):(c.ys.push(b.readShort(d,e)),e+=2);for(a=e=d=0;a<f;a++)d+=c.xs[a],e+=c.ys[a],c.xs[a]=d,c.ys[a]=e}else{c.parts=[];do a=b.readUshort(d,e),e+=2,f={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1},c.parts.push(f),f.glyphIndex=b.readUshort(d,e),e+=2,a&1?(h=b.readShort(d,e),e+=2,l=b.readShort(d,e),e+=2):
(h=b.readInt8(d,e),e++,l=b.readInt8(d,e),e++),a&2?(f.m.tx=h,f.m.ty=l):(f.p1=h,f.p2=l),a&8?(f.m.a=f.m.d=b.readF2dot14(d,e),e+=2):a&64?(f.m.a=b.readF2dot14(d,e),e+=2,f.m.d=b.readF2dot14(d,e),e+=2):a&128&&(f.m.a=b.readF2dot14(d,e),e+=2,f.m.b=b.readF2dot14(d,e),e+=2,f.m.c=b.readF2dot14(d,e),e+=2,f.m.d=b.readF2dot14(d,e),e+=2);while(a&32);if(a&256)for(b=b.readUshort(d,e),e+=2,c.instr=[],a=0;a<b;a++)c.instr.push(d[e]),e++}return c};g.GPOS={};g.GPOS.parse=function(c,a,b,d){return g._lctf.parse(c,a,b,d,g.GPOS.subt)};
g.GPOS.subt=function(c,a,b){var d=g._bin,e=b,f={};f.fmt=d.readUshort(c,b);b+=2;if(1==a||2==a||3==a||7==a||8==a&&2>=f.fmt){var h=d.readUshort(c,b);b+=2;f.coverage=g._lctf.readCoverage(c,h+e)}if(1==a&&1==f.fmt){var l=d.readUshort(c,b);b+=2;g._lctf.numOfOnes(l);0!=l&&(f.pos=g.GPOS.readValueRecord(c,b,l))}else if(2==a){l=d.readUshort(c,b);b+=2;var q=d.readUshort(c,b);b+=2;a=g._lctf.numOfOnes(l);h=g._lctf.numOfOnes(q);if(1==f.fmt){f.pairsets=[];var r=d.readUshort(c,b);b+=2;for(var k=0;k<r;k++){var p=e+
d.readUshort(c,b);b+=2;var n=d.readUshort(c,p);p+=2;for(var m=[],u=0;u<n;u++){var v=d.readUshort(c,p);p+=2;if(0!=l){var w=g.GPOS.readValueRecord(c,p,l);p+=2*a}if(0!=q){var y=g.GPOS.readValueRecord(c,p,q);p+=2*h}m.push({gid2:v,val1:w,val2:y})}f.pairsets.push(m)}}if(2==f.fmt)for(w=d.readUshort(c,b),b+=2,y=d.readUshort(c,b),b+=2,l=d.readUshort(c,b),b+=2,d=d.readUshort(c,b),b+=2,f.classDef1=g._lctf.readClassDef(c,e+w),f.classDef2=g._lctf.readClassDef(c,e+y),f.matrix=[],k=0;k<l;k++){e=[];for(u=0;u<d;u++)y=
w=null,0!=f.valFmt1&&(w=g.GPOS.readValueRecord(c,b,f.valFmt1),b+=2*a),0!=f.valFmt2&&(y=g.GPOS.readValueRecord(c,b,f.valFmt2),b+=2*h),e.push({val1:w,val2:y});f.matrix.push(e)}}return f};g.GPOS.readValueRecord=function(c,a,b){var d=g._bin,e=[];e.push(b&1?d.readShort(c,a):0);a+=b&1?2:0;e.push(b&2?d.readShort(c,a):0);a+=b&2?2:0;e.push(b&4?d.readShort(c,a):0);e.push(b&8?d.readShort(c,a+(b&4?2:0)):0);return e};g.GSUB={};g.GSUB.parse=function(c,a,b,d){return g._lctf.parse(c,a,b,d,g.GSUB.subt)};g.GSUB.subt=
function(c,a,b){var d=g._bin,e=b,f={};f.fmt=d.readUshort(c,b);b+=2;if(1!=a&&4!=a&&5!=a&&6!=a)return null;if(1==a||4==a||5==a&&2>=f.fmt||6==a&&2>=f.fmt){var h=d.readUshort(c,b);b+=2;f.coverage=g._lctf.readCoverage(c,e+h)}if(1==a)1==f.fmt?f.delta=d.readShort(c,b):2==f.fmt&&(h=d.readUshort(c,b),f.newg=d.readUshorts(c,b+2,h));else if(4==a)for(f.vals=[],h=d.readUshort(c,b),b+=2,a=0;a<h;a++){var l=d.readUshort(c,b);b+=2;f.vals.push(g.GSUB.readLigatureSet(c,e+l))}else if(5==a){if(2==f.fmt)for(a=d.readUshort(c,
b),b+=2,f.cDef=g._lctf.readClassDef(c,e+a),f.scset=[],h=d.readUshort(c,b),b+=2,a=0;a<h;a++)l=d.readUshort(c,b),b+=2,f.scset.push(0==l?null:g.GSUB.readSubClassSet(c,e+l))}else if(6==a&&3==f.fmt){for(a=0;3>a;a++){h=d.readUshort(c,b);b+=2;l=[];for(var q=0;q<h;q++)l.push(g._lctf.readCoverage(c,e+d.readUshort(c,b+2*q)));b+=2*h;0==a&&(f.backCvg=l);1==a&&(f.inptCvg=l);2==a&&(f.ahedCvg=l)}h=d.readUshort(c,b);f.lookupRec=g.GSUB.readSubstLookupRecords(c,b+2,h)}return f};g.GSUB.readSubClassSet=function(c,a){var b=
g._bin.readUshort,d=a,e=[],f=b(c,a);a+=2;for(var h=0;h<f;h++){var l=b(c,a);a+=2;e.push(g.GSUB.readSubClassRule(c,d+l))}return e};g.GSUB.readSubClassRule=function(c,a){var b=g._bin.readUshort,d={},e=b(c,a);a+=2;var f=b(c,a);a+=2;d.input=[];for(var h=0;h<e-1;h++)d.input.push(b(c,a)),a+=2;d.substLookupRecords=g.GSUB.readSubstLookupRecords(c,a,f);return d};g.GSUB.readSubstLookupRecords=function(c,a,b){for(var d=g._bin.readUshort,e=[],f=0;f<b;f++)e.push(d(c,a),d(c,a+2)),a+=4;return e};g.GSUB.readChainSubClassSet=
function(c,a){var b=g._bin,d=a,e=[],f=b.readUshort(c,a);a+=2;for(var h=0;h<f;h++){var l=b.readUshort(c,a);a+=2;e.push(g.GSUB.readChainSubClassRule(c,d+l))}return e};g.GSUB.readChainSubClassRule=function(c,a){for(var b=g._bin,d={},e=["backtrack","input","lookahead"],f=0;f<e.length;f++){var h=b.readUshort(c,a);a+=2;1==f&&h--;d[e[f]]=b.readUshorts(c,a,h);a+=2*d[e[f]].length}h=b.readUshort(c,a);d.subst=b.readUshorts(c,a+2,2*h);return d};g.GSUB.readLigatureSet=function(c,a){var b=g._bin,d=a,e=[],f=b.readUshort(c,
a);a+=2;for(var h=0;h<f;h++){var l=b.readUshort(c,a);a+=2;e.push(g.GSUB.readLigature(c,d+l))}return e};g.GSUB.readLigature=function(c,a){var b=g._bin,d={chain:[]};d.nglyph=b.readUshort(c,a);a+=2;var e=b.readUshort(c,a);a+=2;for(var f=0;f<e-1;f++)d.chain.push(b.readUshort(c,a)),a+=2;return d};g.head={};g.head.parse=function(c,a,b){b=g._bin;var d={};b.readFixed(c,a);a+=4;d.fontRevision=b.readFixed(c,a);a+=4;b.readUint(c,a);a+=4;b.readUint(c,a);a+=4;d.flags=b.readUshort(c,a);a+=2;d.unitsPerEm=b.readUshort(c,
a);a+=2;d.created=b.readUint64(c,a);a+=8;d.modified=b.readUint64(c,a);a+=8;d.xMin=b.readShort(c,a);a+=2;d.yMin=b.readShort(c,a);a+=2;d.xMax=b.readShort(c,a);a+=2;d.yMax=b.readShort(c,a);a+=2;d.macStyle=b.readUshort(c,a);a+=2;d.lowestRecPPEM=b.readUshort(c,a);a+=2;d.fontDirectionHint=b.readShort(c,a);a+=2;d.indexToLocFormat=b.readShort(c,a);d.glyphDataFormat=b.readShort(c,a+2);return d};g.hhea={};g.hhea.parse=function(c,a,b){b=g._bin;var d={};b.readFixed(c,a);a+=4;d.ascender=b.readShort(c,a);a+=2;
d.descender=b.readShort(c,a);a+=2;d.lineGap=b.readShort(c,a);a+=2;d.advanceWidthMax=b.readUshort(c,a);a+=2;d.minLeftSideBearing=b.readShort(c,a);a+=2;d.minRightSideBearing=b.readShort(c,a);a+=2;d.xMaxExtent=b.readShort(c,a);a+=2;d.caretSlopeRise=b.readShort(c,a);a+=2;d.caretSlopeRun=b.readShort(c,a);a+=2;d.caretOffset=b.readShort(c,a);a=a+2+8;d.metricDataFormat=b.readShort(c,a);d.numberOfHMetrics=b.readUshort(c,a+2);return d};g.hmtx={};g.hmtx.parse=function(c,a,b,d){b=g._bin;for(var e={aWidth:[],
lsBearing:[]},f=0,h=0,l=0;l<d.maxp.numGlyphs;l++)l<d.hhea.numberOfHMetrics&&(f=b.readUshort(c,a),a+=2,h=b.readShort(c,a),a+=2),e.aWidth.push(f),e.lsBearing.push(h);return e};g.kern={};g.kern.parse=function(c,a,b,d){var e=g._bin,f=e.readUshort(c,a);a+=2;if(1==f)return g.kern.parseV1(c,a-2,b,d);b=e.readUshort(c,a);a+=2;d={glyph1:[],rval:[]};for(f=0;f<b;f++){a+=2;e.readUshort(c,a);a+=2;var h=e.readUshort(c,a);a+=2;h>>>=8;h&=15;if(0==h)a=g.kern.readFormat0(c,a,d);else throw"unknown kern table format: "+
h;}return d};g.kern.parseV1=function(c,a,b,d){b=g._bin;b.readFixed(c,a);a+=4;d=b.readUint(c,a);a+=4;for(var e={glyph1:[],rval:[]},f=0;f<d;f++){b.readUint(c,a);a+=4;var h=b.readUshort(c,a);a+=2;b.readUshort(c,a);a+=2;h>>>=8;h&=15;if(0==h)a=g.kern.readFormat0(c,a,e);else throw"unknown kern table format: "+h;}return e};g.kern.readFormat0=function(c,a,b){var d=g._bin,e=-1,f=d.readUshort(c,a);a+=2;d.readUshort(c,a);a+=2;d.readUshort(c,a);a+=2;d.readUshort(c,a);a+=2;for(var h=0;h<f;h++){var l=d.readUshort(c,
a);a+=2;var q=d.readUshort(c,a);a+=2;var k=d.readShort(c,a);a+=2;l!=e&&(b.glyph1.push(l),b.rval.push({glyph2:[],vals:[]}));e=b.rval[b.rval.length-1];e.glyph2.push(q);e.vals.push(k);e=l}return a};g.loca={};g.loca.parse=function(c,a,b,d){b=g._bin;var e=[],f=d.head.indexToLocFormat;d=d.maxp.numGlyphs+1;if(0==f)for(var h=0;h<d;h++)e.push(b.readUshort(c,a+(h<<1))<<1);if(1==f)for(h=0;h<d;h++)e.push(b.readUint(c,a+(h<<2)));return e};g.maxp={};g.maxp.parse=function(c,a,b){b=g._bin;var d={},e=b.readUint(c,
a);a+=4;d.numGlyphs=b.readUshort(c,a);a+=2;65536==e&&(d.maxPoints=b.readUshort(c,a),a+=2,d.maxContours=b.readUshort(c,a),a+=2,d.maxCompositePoints=b.readUshort(c,a),a+=2,d.maxCompositeContours=b.readUshort(c,a),a+=2,d.maxZones=b.readUshort(c,a),a+=2,d.maxTwilightPoints=b.readUshort(c,a),a+=2,d.maxStorage=b.readUshort(c,a),a+=2,d.maxFunctionDefs=b.readUshort(c,a),a+=2,d.maxInstructionDefs=b.readUshort(c,a),a+=2,d.maxStackElements=b.readUshort(c,a),a+=2,d.maxSizeOfInstructions=b.readUshort(c,a),a+=
2,d.maxComponentElements=b.readUshort(c,a),d.maxComponentDepth=b.readUshort(c,a+2));return d};g.name={};g.name.parse=function(c,a,b){b=g._bin;var d={};b.readUshort(c,a);a+=2;var e=b.readUshort(c,a);a+=2;b.readUshort(c,a);a+=2;for(var f="copyright fontFamily fontSubfamily ID fullName version postScriptName trademark manufacturer designer description urlVendor urlDesigner licence licenceURL --- typoFamilyName typoSubfamilyName compatibleFull sampleText postScriptCID wwsFamilyName wwsSubfamilyName lightPalette darkPalette".split(" "),
h=a,l=0;l<e;l++){var q=b.readUshort(c,a);a+=2;var k=b.readUshort(c,a);a+=2;var t=b.readUshort(c,a);a+=2;var p=b.readUshort(c,a);a+=2;var n=b.readUshort(c,a);a+=2;var m=b.readUshort(c,a);a+=2;p=f[p];m=h+12*e+m;if(0==q)n=b.readUnicode(c,m,n/2);else if(3==q&&0==k)n=b.readUnicode(c,m,n/2);else if(0==k)n=b.readASCII(c,m,n);else if(1==k)n=b.readUnicode(c,m,n/2);else if(3==k)n=b.readUnicode(c,m,n/2);else if(1==q)n=b.readASCII(c,m,n),console.log("reading unknown MAC encoding "+k+" as ASCII");else throw"unknown encoding "+
k+", platformID: "+q;q="p"+q+","+t.toString(16);null==d[q]&&(d[q]={});d[q][p]=n;d[q]._lang=t}for(var u in d)if(null!=d[u].postScriptName&&1033==d[u]._lang)return d[u];for(u in d)if(null!=d[u].postScriptName&&0==d[u]._lang)return d[u];for(u in d)if(null!=d[u].postScriptName&&3084==d[u]._lang)return d[u];for(u in d)if(null!=d[u].postScriptName)return d[u];for(u in d){var v=u;break}console.log("returning name table with languageID "+d[v]._lang);return d[v]};g["OS/2"]={};g["OS/2"].parse=function(c,a,
b){b=g._bin.readUshort(c,a);a+=2;var d={};if(0==b)g["OS/2"].version0(c,a,d);else if(1==b)g["OS/2"].version1(c,a,d);else if(2==b||3==b||4==b)g["OS/2"].version2(c,a,d);else if(5==b)g["OS/2"].version5(c,a,d);else throw"unknown OS/2 table version: "+b;return d};g["OS/2"].version0=function(c,a,b){var d=g._bin;b.xAvgCharWidth=d.readShort(c,a);a+=2;b.usWeightClass=d.readUshort(c,a);a+=2;b.usWidthClass=d.readUshort(c,a);a+=2;b.fsType=d.readUshort(c,a);a+=2;b.ySubscriptXSize=d.readShort(c,a);a+=2;b.ySubscriptYSize=
d.readShort(c,a);a+=2;b.ySubscriptXOffset=d.readShort(c,a);a+=2;b.ySubscriptYOffset=d.readShort(c,a);a+=2;b.ySuperscriptXSize=d.readShort(c,a);a+=2;b.ySuperscriptYSize=d.readShort(c,a);a+=2;b.ySuperscriptXOffset=d.readShort(c,a);a+=2;b.ySuperscriptYOffset=d.readShort(c,a);a+=2;b.yStrikeoutSize=d.readShort(c,a);a+=2;b.yStrikeoutPosition=d.readShort(c,a);a+=2;b.sFamilyClass=d.readShort(c,a);a+=2;b.panose=d.readBytes(c,a,10);a+=10;b.ulUnicodeRange1=d.readUint(c,a);a+=4;b.ulUnicodeRange2=d.readUint(c,
a);a+=4;b.ulUnicodeRange3=d.readUint(c,a);a+=4;b.ulUnicodeRange4=d.readUint(c,a);a+=4;b.achVendID=[d.readInt8(c,a),d.readInt8(c,a+1),d.readInt8(c,a+2),d.readInt8(c,a+3)];a+=4;b.fsSelection=d.readUshort(c,a);a+=2;b.usFirstCharIndex=d.readUshort(c,a);a+=2;b.usLastCharIndex=d.readUshort(c,a);a+=2;b.sTypoAscender=d.readShort(c,a);a+=2;b.sTypoDescender=d.readShort(c,a);a+=2;b.sTypoLineGap=d.readShort(c,a);a+=2;b.usWinAscent=d.readUshort(c,a);a+=2;b.usWinDescent=d.readUshort(c,a);return a+2};g["OS/2"].version1=
function(c,a,b){var d=g._bin;a=g["OS/2"].version0(c,a,b);b.ulCodePageRange1=d.readUint(c,a);a+=4;b.ulCodePageRange2=d.readUint(c,a);return a+4};g["OS/2"].version2=function(c,a,b){var d=g._bin;a=g["OS/2"].version1(c,a,b);b.sxHeight=d.readShort(c,a);a+=2;b.sCapHeight=d.readShort(c,a);a+=2;b.usDefault=d.readUshort(c,a);a+=2;b.usBreak=d.readUshort(c,a);a+=2;b.usMaxContext=d.readUshort(c,a);return a+2};g["OS/2"].version5=function(c,a,b){var d=g._bin;a=g["OS/2"].version2(c,a,b);b.usLowerOpticalPointSize=
d.readUshort(c,a);a+=2;b.usUpperOpticalPointSize=d.readUshort(c,a);return a+2};g.post={};g.post.parse=function(c,a,b){b=g._bin;var d={};d.version=b.readFixed(c,a);a+=4;d.italicAngle=b.readFixed(c,a);a+=4;d.underlinePosition=b.readShort(c,a);d.underlineThickness=b.readShort(c,a+2);return d};g.SVG={};g.SVG.parse=function(c,a,b){b=g._bin;var d={entries:[]},e=a;b.readUshort(c,a);a+=2;var f=b.readUint(c,a);b.readUint(c,a+4);a=f+e;var h=b.readUshort(c,a);a+=2;for(var l=0;l<h;l++){var q=b.readUshort(c,a);
a+=2;var k=b.readUshort(c,a);a+=2;var t=b.readUint(c,a);a+=4;var p=b.readUint(c,a);a+=4;t=new Uint8Array(c.buffer,e+t+f,p);for(t=b.readUTF8(t,0,t.length);q<=k;q++)d.entries[q]=t}return d};g.SVG.toPath=function(c){var a={cmds:[],crds:[]};if(null==c)return a;for(var b=(new DOMParser).parseFromString(c,"image/svg+xml").firstChild;"svg"!=b.tagName;)b=b.nextSibling;c=(c=b.getAttribute("viewBox"))?c.trim().split(" ").map(parseFloat):[0,0,1E3,1E3];g.SVG._toPath(b.children,a);for(b=0;b<a.crds.length;b+=2){var d=
a.crds[b],e=a.crds[b+1];d-=c[0];e-=c[1];e=-e;a.crds[b]=d;a.crds[b+1]=e}return a};g.SVG._toPath=function(c,a,b){for(var d=0;d<c.length;d++){var e=c[d],f=e.tagName,h=e.getAttribute("fill");null==h&&(h=b);"g"==f?g.SVG._toPath(e.children,a,h):"path"==f?(a.cmds.push(h?h:"#000000"),e=e.getAttribute("d"),e=g.SVG._tokens(e),g.SVG._toksToPath(e,a),a.cmds.push("X")):"defs"!=f&&console.log(f,e)}};g.SVG._tokens=function(c){for(var a=[],b=0,d=!1,e="";b<c.length;){var f=c.charCodeAt(b),g=c.charAt(b);b++;f=48<=
f&&57>=f||"."==g||"-"==g;d?"-"==g?(a.push(parseFloat(e)),e=g):f?e+=g:(a.push(parseFloat(e)),","!=g&&" "!=g&&a.push(g),d=!1):f?(e=g,d=!0):","!=g&&" "!=g&&a.push(g)}d&&a.push(parseFloat(e));return a};g.SVG._toksToPath=function(c,a){var b=0,d=0,e=0,f=0,h=0,l={M:2,L:2,H:1,V:1,S:4,C:6},q=a.cmds;for(a=a.crds;b<c.length;){var k=c[b];b++;if("z"==k)q.push("Z"),d=f,e=h;else for(var t=k.toUpperCase(),p=g.SVG._reps(c,b,l[t]),n=0;n<p;n++){var m=0,u=0;k!=t&&(m=d,u=e);if("M"==t)d=m+c[b++],e=u+c[b++],q.push("M"),
a.push(d,e),f=d,h=e;else if("L"==t)d=m+c[b++],e=u+c[b++],q.push("L"),a.push(d,e);else if("H"==t)d=m+c[b++],q.push("L"),a.push(d,e);else if("V"==t)e=u+c[b++],q.push("L"),a.push(d,e);else if("C"==t){d=m+c[b++];e=u+c[b++];var v=m+c[b++],w=u+c[b++];m+=c[b++];u+=c[b++];q.push("C");a.push(d,e,v,w,m,u);d=m;e=u}else"S"==t?(v=Math.max(a.length-4,0),d=d+d-a[v],e=e+e-a[v+1],v=m+c[b++],w=u+c[b++],m+=c[b++],u+=c[b++],q.push("C"),a.push(d,e,v,w,m,u),d=m,e=u):console.log("Unknown SVG command "+k)}}};g.SVG._reps=
function(c,a,b){for(var d=a;d<c.length&&"string"!=typeof c[d];)d+=b;return(d-a)/b};null==g&&(g={});null==g.U&&(g.U={});g.U.codeToGlyph=function(c,a){c=c.cmap;var b=-1;null!=c.p0e4?b=c.p0e4:null!=c.p3e1?b=c.p3e1:null!=c.p1e0?b=c.p1e0:null!=c.p0e3&&(b=c.p0e3);if(-1==b)throw"no familiar platform and encoding!";c=c.tables[b];if(0==c.format)return a>=c.map.length?0:c.map[a];if(4==c.format){var d=-1;for(b=0;b<c.endCount.length;b++)if(a<=c.endCount[b]){d=b;break}return-1==d||c.startCount[d]>a?0:(0!=c.idRangeOffset[d]?
c.glyphIdArray[a-c.startCount[d]+(c.idRangeOffset[d]>>1)-(c.idRangeOffset.length-d)]:a+c.idDelta[d])&65535}if(12==c.format){if(a>c.groups[c.groups.length-1][1])return 0;for(b=0;b<c.groups.length;b++)if(d=c.groups[b],d[0]<=a&&a<=d[1])return d[2]+(a-d[0]);return 0}throw"unknown cmap table format "+c.format;};g.U.glyphToPath=function(c,a){var b={cmds:[],crds:[]};if(c.SVG&&c.SVG.entries[a]){var d=c.SVG.entries[a];if(null==d)return b;"string"==typeof d&&(d=g.SVG.toPath(d),c.SVG.entries[a]=d);return d}if(c.CFF){d=
{x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:c.CFF.Private?c.CFF.Private.defaultWidthX:0,open:!1};var e=c.CFF,f=c.CFF.Private;if(e.ROS){for(f=0;e.FDSelect[f+2]<=a;)f+=2;f=e.FDArray[e.FDSelect[f+1]].Private}g.U._drawCFF(c.CFF.CharStrings[a],d,e,f,b)}else c.glyf&&g.U._drawGlyf(a,c,b);return b};g.U._drawGlyf=function(c,a,b){var d=a.glyf[c];null==d&&(d=a.glyf[c]=g.glyf._parseGlyf(a,c));null!=d&&(-1<d.noc?g.U._simpleGlyph(d,b):g.U._compoGlyph(d,a,b))};g.U._simpleGlyph=function(c,a){for(var b=0;b<c.noc;b++){for(var d=
0==b?0:c.endPts[b-1]+1,e=c.endPts[b],f=d;f<=e;f++){var h=f==d?e:f-1,l=f==e?d:f+1,q=c.flags[f]&1,k=c.flags[h]&1,t=c.flags[l]&1,p=c.xs[f],n=c.ys[f];if(f==d)if(q)if(k)g.U.P.moveTo(a,c.xs[h],c.ys[h]);else{g.U.P.moveTo(a,p,n);continue}else k?g.U.P.moveTo(a,c.xs[h],c.ys[h]):g.U.P.moveTo(a,(c.xs[h]+p)/2,(c.ys[h]+n)/2);q?k&&g.U.P.lineTo(a,p,n):t?g.U.P.qcurveTo(a,p,n,c.xs[l],c.ys[l]):g.U.P.qcurveTo(a,p,n,(p+c.xs[l])/2,(n+c.ys[l])/2)}g.U.P.closePath(a)}};g.U._compoGlyph=function(c,a,b){for(var d=0;d<c.parts.length;d++){var e=
{cmds:[],crds:[]},f=c.parts[d];g.U._drawGlyf(f.glyphIndex,a,e);f=f.m;for(var h=0;h<e.crds.length;h+=2){var l=e.crds[h],q=e.crds[h+1];b.crds.push(l*f.a+q*f.b+f.tx);b.crds.push(l*f.c+q*f.d+f.ty)}for(h=0;h<e.cmds.length;h++)b.cmds.push(e.cmds[h])}};g.U._getGlyphClass=function(c,a){c=g._lctf.getInterval(a,c);return-1==c?0:a[c+2]};g.U.getPairAdjustment=function(c,a,b){if(c.GPOS){var d=c.GPOS,e=d.lookupList;d=d.featureList;for(var f=[],h=0;h<d.length;h++){var l=d[h];if("kern"==l.tag)for(var q=0;q<l.tab.length;q++)if(!f[l.tab[q]]){f[l.tab[q]]=
!0;for(var k=e[l.tab[q]],t=0;t<k.tabs.length;t++)if(null!=k.tabs[h]){var p=k.tabs[t];if(p.coverage){var n=g._lctf.coverageIndex(p.coverage,a);if(-1==n)continue}if(1!=k.ltype&&2==k.ltype){var m;if(1==p.fmt)for(p=p.pairsets[n],h=0;h<p.length;h++)p[h].gid2==b&&(m=p[h]);else if(2==p.fmt){m=g.U._getGlyphClass(a,p.classDef1);var u=g.U._getGlyphClass(b,p.classDef2);m=p.matrix[m][u]}if(m&&m.val2)return m.val2[2]}}}}}return c.kern&&(a=c.kern.glyph1.indexOf(a),-1!=a&&(b=c.kern.rval[a].glyph2.indexOf(b),-1!=
b))?c.kern.rval[a].vals[b]:0};g.U.stringToGlyphs=function(c,a){for(var b=[],d=0;d<a.length;d++){var e=a.codePointAt(d);65535<e&&d++;b.push(g.U.codeToGlyph(c,e))}for(d=0;d<a.length;d++){e=a.codePointAt(d);if(2367==e){var f=b[d-1];b[d-1]=b[d];b[d]=f}65535<e&&d++}d=c.GSUB;if(null==d)return b;c=d.lookupList;d=d.featureList;e="rlig liga mset isol init fina medi half pres blws".split(" ");f=[];for(var h=0;h<d.length;h++){var l=d[h];if(-1!=e.indexOf(l.tag))for(var k=0;k<l.tab.length;k++)if(!f[l.tab[k]]){f[l.tab[k]]=
!0;for(var r=c[l.tab[k]],t=0;t<b.length;t++){var p=g.U._getWPfeature(a,t);-1!="isol,init,fina,medi".indexOf(l.tag)&&l.tag!=p||g.U._applySubs(b,t,r,c)}}}return b};g.U._getWPfeature=function(c,a){var b=0==a||-1!='\n\t" ,.:;!?()  \u060c'.indexOf(c[a-1]),d=a==c.length-1||-1!='\n\t" ,.:;!?()  \u060c'.indexOf(c[a+1]);b||-1=="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac".indexOf(c[a-
1])||(b=!0);d||-1=="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac".indexOf(c[a])||
(d=!0);d||-1=="\ua872\u0acd\u0ad7".indexOf(c[a+1])||(d=!0);b||-1=="\ua872\u0acd\u0ad7".indexOf(c[a])||(b=!0);return b?d?"isol":"init":d?"fina":"medi"};g.U._applySubs=function(c,a,b,d){for(var e=c.length-a-1,f=0;f<b.tabs.length;f++)if(null!=b.tabs[f]){var h=b.tabs[f];if(h.coverage){var l=g._lctf.coverageIndex(h.coverage,c[a]);if(-1==l)continue}if(1==b.ltype)c[a]=1==h.fmt?c[a]+h.delta:h.newg[l];else if(4==b.ltype)for(var k=h.vals[l],r=0;r<k.length;r++){var t=k[r];h=t.chain.length;if(!(h>e)){for(var p=
!0,n=0,m=0;m<h;m++){for(;-1==c[a+n+(1+m)];)n++;t.chain[m]!=c[a+n+(1+m)]&&(p=!1)}if(p){c[a]=t.nglyph;for(m=0;m<h+n;m++)c[a+m+1]=-1;break}}}else if(5==b.ltype&&2==h.fmt)for(k=g._lctf.getInterval(h.cDef,c[a]),n=h.scset[h.cDef[k+2]],t=0;t<n.length;t++){r=n[t];var u=r.input;if(!(u.length>e)){p=!0;for(m=0;m<u.length;m++){var v=g._lctf.getInterval(h.cDef,c[a+1+m]);if(-1==k&&h.cDef[v+2]!=u[m]){p=!1;break}}if(p)for(p=r.substLookupRecords,r=0;r<p.length;r+=2);}}else if(6==b.ltype&&3==h.fmt&&g.U._glsCovered(c,
h.backCvg,a-h.backCvg.length)&&g.U._glsCovered(c,h.inptCvg,a)&&g.U._glsCovered(c,h.ahedCvg,a+h.inptCvg.length))for(p=h.lookupRec,t=0;t<p.length;t+=2)k=p[t],g.U._applySubs(c,a+k,d[p[t+1]],d)}};g.U._glsCovered=function(c,a,b){for(var d=0;d<a.length;d++)if(-1==g._lctf.coverageIndex(a[d],c[b+d]))return!1;return!0};g.U.glyphsToPath=function(c,a,b){for(var d={cmds:[],crds:[]},e=0,f=0;f<a.length;f++){var h=a[f];if(-1!=h){for(var l=f<a.length-1&&-1!=a[f+1]?a[f+1]:0,k=g.U.glyphToPath(c,h),r=0;r<k.crds.length;r+=
2)d.crds.push(k.crds[r]+e),d.crds.push(k.crds[r+1]);b&&d.cmds.push(b);for(r=0;r<k.cmds.length;r++)d.cmds.push(k.cmds[r]);b&&d.cmds.push("X");e+=c.hmtx.aWidth[h];f<a.length-1&&(e+=g.U.getPairAdjustment(c,h,l))}}return d};g.U.pathToSVG=function(c,a){null==a&&(a=5);for(var b=[],d=0,e={M:2,L:2,Q:4,C:6},f=0;f<c.cmds.length;f++){var g=c.cmds[f],l=d+(e[g]?e[g]:0);for(b.push(g);d<l;)g=c.crds[d++],b.push(parseFloat(g.toFixed(a))+(d==l?"":" "))}return b.join("")};g.U.pathToContext=function(c,a){for(var b=0,
d=c.crds,e=0;e<c.cmds.length;e++){var f=c.cmds[e];"M"==f?(a.moveTo(d[b],d[b+1]),b+=2):"L"==f?(a.lineTo(d[b],d[b+1]),b+=2):"C"==f?(a.bezierCurveTo(d[b],d[b+1],d[b+2],d[b+3],d[b+4],d[b+5]),b+=6):"Q"==f?(a.quadraticCurveTo(d[b],d[b+1],d[b+2],d[b+3]),b+=4):"#"==f.charAt(0)?(a.beginPath(),a.fillStyle=f):"Z"==f?a.closePath():"X"==f&&a.fill()}};g.U.P={};g.U.P.moveTo=function(c,a,b){c.cmds.push("M");c.crds.push(a,b)};g.U.P.lineTo=function(c,a,b){c.cmds.push("L");c.crds.push(a,b)};g.U.P.curveTo=function(c,
a,b,d,e,f,g){c.cmds.push("C");c.crds.push(a,b,d,e,f,g)};g.U.P.qcurveTo=function(c,a,b,d,e){c.cmds.push("Q");c.crds.push(a,b,d,e)};g.U.P.closePath=function(c){c.cmds.push("Z")};g.U._drawCFF=function(c,a,b,d,e){for(var f=a.stack,h=a.nStems,l=a.haveWidth,k=a.width,r=a.open,t=0,p=a.x,n=a.y,m,u,v,w,y,z,E,F,C,B,A={val:0,size:0};t<c.length;){g.CFF.getCharString(c,t,A);var x=A.val;t+=A.size;if("o1"==x||"o18"==x)(m=0!==f.length%2)&&!l&&(k=f.shift()+d.nominalWidthX),h+=f.length>>1,f.length=0,l=!0;else if("o3"==
x||"o23"==x)(m=0!==f.length%2)&&!l&&(k=f.shift()+d.nominalWidthX),h+=f.length>>1,f.length=0,l=!0;else if("o4"==x)1<f.length&&!l&&(k=f.shift()+d.nominalWidthX,l=!0),r&&g.U.P.closePath(e),n+=f.pop(),g.U.P.moveTo(e,p,n),r=!0;else if("o5"==x)for(;0<f.length;)p+=f.shift(),n+=f.shift(),g.U.P.lineTo(e,p,n);else if("o6"==x||"o7"==x)for(y=f.length,m="o6"==x,u=0;u<y;u++)v=f.shift(),m?p+=v:n+=v,m=!m,g.U.P.lineTo(e,p,n);else if("o8"==x||"o24"==x){y=f.length;for(z=0;z+6<=y;)m=p+f.shift(),u=n+f.shift(),v=m+f.shift(),
w=u+f.shift(),p=v+f.shift(),n=w+f.shift(),g.U.P.curveTo(e,m,u,v,w,p,n),z+=6;"o24"==x&&(p+=f.shift(),n+=f.shift(),g.U.P.lineTo(e,p,n))}else if("o11"==x)break;else if("o1234"==x||"o1235"==x||"o1236"==x||"o1237"==x)"o1234"==x&&(m=p+f.shift(),u=n,v=m+f.shift(),w=u+f.shift(),C=v+f.shift(),B=w,y=C+f.shift(),z=w,E=y+f.shift(),F=n,p=E+f.shift(),g.U.P.curveTo(e,m,u,v,w,C,B),g.U.P.curveTo(e,y,z,E,F,p,n)),"o1235"==x&&(m=p+f.shift(),u=n+f.shift(),v=m+f.shift(),w=u+f.shift(),C=v+f.shift(),B=w+f.shift(),y=C+f.shift(),
z=B+f.shift(),E=y+f.shift(),F=z+f.shift(),p=E+f.shift(),n=F+f.shift(),f.shift(),g.U.P.curveTo(e,m,u,v,w,C,B),g.U.P.curveTo(e,y,z,E,F,p,n)),"o1236"==x&&(m=p+f.shift(),u=n+f.shift(),v=m+f.shift(),w=u+f.shift(),C=v+f.shift(),B=w,y=C+f.shift(),z=w,E=y+f.shift(),F=z+f.shift(),p=E+f.shift(),g.U.P.curveTo(e,m,u,v,w,C,B),g.U.P.curveTo(e,y,z,E,F,p,n)),"o1237"==x&&(m=p+f.shift(),u=n+f.shift(),v=m+f.shift(),w=u+f.shift(),C=v+f.shift(),B=w+f.shift(),y=C+f.shift(),z=B+f.shift(),E=y+f.shift(),F=z+f.shift(),Math.abs(E-
p)>Math.abs(F-n)?p=E+f.shift():n=F+f.shift(),g.U.P.curveTo(e,m,u,v,w,C,B),g.U.P.curveTo(e,y,z,E,F,p,n));else if("o14"==x)0<f.length&&!l&&(k=f.shift()+b.nominalWidthX,l=!0),4==f.length&&(m=f.shift(),u=f.shift(),w=f.shift(),v=f.shift(),w=g.CFF.glyphBySE(b,w),v=g.CFF.glyphBySE(b,v),g.U._drawCFF(b.CharStrings[w],a,b,d,e),a.x=m,a.y=u,g.U._drawCFF(b.CharStrings[v],a,b,d,e)),r&&(g.U.P.closePath(e),r=!1);else if("o19"==x||"o20"==x)(m=0!==f.length%2)&&!l&&(k=f.shift()+d.nominalWidthX),h+=f.length>>1,f.length=
0,l=!0,t+=h+7>>3;else if("o21"==x)2<f.length&&!l&&(k=f.shift()+d.nominalWidthX,l=!0),n+=f.pop(),p+=f.pop(),r&&g.U.P.closePath(e),g.U.P.moveTo(e,p,n),r=!0;else if("o22"==x)1<f.length&&!l&&(k=f.shift()+d.nominalWidthX,l=!0),p+=f.pop(),r&&g.U.P.closePath(e),g.U.P.moveTo(e,p,n),r=!0;else if("o25"==x){for(;6<f.length;)p+=f.shift(),n+=f.shift(),g.U.P.lineTo(e,p,n);m=p+f.shift();u=n+f.shift();v=m+f.shift();w=u+f.shift();p=v+f.shift();n=w+f.shift();g.U.P.curveTo(e,m,u,v,w,p,n)}else if("o26"==x)for(f.length%
2&&(p+=f.shift());0<f.length;)m=p,u=n+f.shift(),v=m+f.shift(),w=u+f.shift(),p=v,n=w+f.shift(),g.U.P.curveTo(e,m,u,v,w,p,n);else if("o27"==x)for(f.length%2&&(n+=f.shift());0<f.length;)m=p+f.shift(),u=n,v=m+f.shift(),w=u+f.shift(),p=v+f.shift(),n=w,g.U.P.curveTo(e,m,u,v,w,p,n);else if("o10"==x||"o29"==x)m="o10"==x?d:b,0==f.length?console.log("error: empty stack"):(u=f.pop(),m=m.Subrs[u+m.Bias],a.x=p,a.y=n,a.nStems=h,a.haveWidth=l,a.width=k,a.open=r,g.U._drawCFF(m,a,b,d,e),p=a.x,n=a.y,h=a.nStems,l=a.haveWidth,
k=a.width,r=a.open);else if("o30"==x||"o31"==x)for(m=f.length,z=0,x="o31"==x,y=m&-3,z+=m-y;z<y;)x?(m=p+f.shift(),u=n,v=m+f.shift(),w=u+f.shift(),n=w+f.shift(),5==y-z?(p=v+f.shift(),z++):p=v,x=!1):(m=p,u=n+f.shift(),v=m+f.shift(),w=u+f.shift(),p=v+f.shift(),5==y-z?(n=w+f.shift(),z++):n=w,x=!0),g.U.P.curveTo(e,m,u,v,w,p,n),z+=4;else{if("o"==(x+"").charAt(0))throw console.log("Unknown operation: "+x,c),x;f.push(x)}}a.x=p;a.y=n;a.nStems=h;a.haveWidth=l;a.width=k;a.open=r};return g},function(){function k(c,
a){function b(){var a=g.getUint16(l);l+=2;return a}function d(){var a=g.getUint32(l);l+=4;return a}function e(a){y.setUint16(z,a);z+=2}function f(a){y.setUint32(z,a);z+=4}var g=new DataView(c),l=0;d();var k=d();d();var r=b();b();d();b();b();d();d();d();d();d();for(var t=0;Math.pow(2,t)<=r;)t++;t--;for(var p=16*Math.pow(2,t),n=16*r-p,m=12,u=[],v=0;v<r;v++)u.push({tag:d(),offset:d(),compLength:d(),origLength:d(),origChecksum:d()}),m+=16;var w=new Uint8Array(12+16*u.length+u.reduce(function(a,c){return a+
c.origLength+4},0));v=w.buffer;var y=new DataView(v),z=0;f(k);e(r);e(p);e(t);e(n);u.forEach(function(a){f(a.tag);f(a.origChecksum);f(m);f(a.origLength);a.outOffset=m;m+=a.origLength;0!=m%4&&(m+=4-m%4)});var E;u.forEach(function(b){var d=c.slice(b.offset,b.offset+b.compLength);if(b.compLength!=b.origLength){var e=new Uint8Array(b.origLength);a(new Uint8Array(d,2),e)}else e=new Uint8Array(d);w.set(e,b.outOffset);m=b.outOffset+b.origLength;d=0;0!=m%4&&(d=4-m%4);w.set((new Uint8Array(d)).buffer,b.outOffset+
b.origLength);E=m+d});return v.slice(0,E)}var g=function(){function c(){this.table=new Uint16Array(16);this.trans=new Uint16Array(288)}function a(a,b){this.source=a;this.bitcount=this.tag=this.sourceIndex=0;this.dest=b;this.destLen=0;this.ltree=new c;this.dtree=new c}function b(a,c,b,d){var e;for(e=0;e<b;++e)a[e]=0;for(e=0;e<30-b;++e)a[e+b]=e/b|0;b=d;for(e=0;30>e;++e)c[e]=b,b+=1<<a[e]}function d(a,c,b,d){var e,f;for(e=0;16>e;++e)a.table[e]=0;for(e=0;e<d;++e)a.table[c[b+e]]++;for(e=f=a.table[0]=0;16>
e;++e)w[e]=f,f+=a.table[e];for(e=0;e<d;++e)c[b+e]&&(a.trans[w[c[b+e]]++]=e)}function e(a,c,b){if(!c)return b;for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var d=a.tag&65535>>>16-c;a.tag>>>=c;a.bitcount-=c;return d+b}function f(a,c){for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var b=0,d=0,e=0,f=a.tag;do d=2*d+(f&1),f>>>=1,++e,b+=c.table[e],d-=c.table[e];while(0<=d);a.tag=f;a.bitcount-=e;return c.trans[b+d]}function g(a,c,b){for(;;){var d=
f(a,c);if(256===d)return 0;if(256>d)a.dest[a.destLen++]=d;else{var g;d-=257;d=e(a,r[d],t[d]);var h=f(a,b);for(g=h=a.destLen-e(a,p[h],n[h]);g<h+d;++g)a.dest[a.destLen++]=a.dest[g]}}}var l=new c,k=new c,r=new Uint8Array(30),t=new Uint16Array(30),p=new Uint8Array(30),n=new Uint16Array(30),m=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=new c,v=new Uint8Array(320),w=new Uint16Array(16);(function(a,c){var b;for(b=0;7>b;++b)a.table[b]=0;a.table[7]=24;a.table[8]=152;a.table[9]=112;for(b=
0;24>b;++b)a.trans[b]=256+b;for(b=0;144>b;++b)a.trans[24+b]=b;for(b=0;8>b;++b)a.trans[168+b]=280+b;for(b=0;112>b;++b)a.trans[176+b]=144+b;for(b=0;5>b;++b)c.table[b]=0;c.table[5]=32;for(b=0;32>b;++b)c.trans[b]=b})(l,k);b(r,t,4,3);b(p,n,2,1);r[28]=0;t[28]=258;return function(b,c){b=new a(b,c);do{c=b;c.bitcount--||(c.tag=c.source[c.sourceIndex++],c.bitcount=7);var h=c.tag&1;c.tag>>>=1;c=h;h=e(b,2,0);switch(h){case 0:for(h=b;8<h.bitcount;)h.sourceIndex--,h.bitcount-=8;var p=h.source[h.sourceIndex+1];
p=256*p+h.source[h.sourceIndex];var n=h.source[h.sourceIndex+3];n=256*n+h.source[h.sourceIndex+2];if(p!==(~n&65535))h=-3;else{h.sourceIndex+=4;for(n=p;n;--n)h.dest[h.destLen++]=h.source[h.sourceIndex++];h=h.bitcount=0}break;case 1:h=g(b,l,k);break;case 2:var q;p=b;var r=b.ltree,w=b.dtree;n=e(p,5,257);h=e(p,5,1);var t=e(p,4,4);for(q=0;19>q;++q)v[q]=0;for(q=0;q<t;++q){var y=e(p,3,0);v[m[q]]=y}d(u,v,0,19);for(q=0;q<n+h;)switch(t=f(p,u),t){case 16:y=v[q-1];for(t=e(p,2,3);t;--t)v[q++]=y;break;case 17:for(t=
e(p,3,3);t;--t)v[q++]=0;break;case 18:for(t=e(p,7,11);t;--t)v[q++]=0;break;default:v[q++]=t}d(r,v,0,n);d(w,v,n,h);h=g(b,b.ltree,b.dtree);break;default:h=-3}if(0!==h)throw Error("Data error");}while(!c);return b.destLen<b.dest.length?"function"===typeof b.dest.slice?b.dest.slice(0,b.destLen):b.dest.subarray(0,b.destLen):b.dest}}();return function(c){return k(c,g)}},function(k,g){function c(b){var c=Object.create(null),e={unitsPerEm:b.head.unitsPerEm,ascender:b.hhea.ascender,descender:b.hhea.descender,
forEachGlyph:function(d,g,l,q){var f=0,h=1/e.unitsPerEm*g,p=0;k.U.stringToGlyphs(b,d).forEach(function(e){if(-1!==e){var m=c[e];if(!m){m=k.U.glyphToPath(b,e);var n=m.cmds,r=m.crds,w,t;if(r.length){m=w=Infinity;var z=t=-Infinity;for(var E=0,A=r.length;E<A;E+=2){var C=r[E],B=r[E+1];C<m&&(m=C);B<w&&(w=B);C>z&&(z=C);B>t&&(t=B)}}else m=z=w=t=0;m=c[e]={index:e,advanceWidth:b.hmtx.aWidth[e],xMin:m,yMin:w,xMax:z,yMax:t,pathCommandCount:n.length,forEachPathCommand:function(b){for(var c=0,d=[],e=0,f=n.length;e<
f;e++){var g=a[n[e]];d.length=1+g;d[0]=n[e];for(var h=1;h<=g;h++)d[h]=r[c++];b.apply(null,d)}}}}q.call(null,m,f,p);m.advanceWidth&&(f+=m.advanceWidth*h);l&&(f+=l*g)}p+=65535<d.codePointAt(p)?2:1});return f}};return e}var a={M:2,L:2,Q:4,C:6,Z:0};return function(a){var b=new Uint8Array(a,0,4);b=k._bin.readASCII(b,0,4);if("wOFF"===b)a=g(a);else if("wOF2"===b)throw Error("woff2 fonts not supported");return c(k.parse(a)[0])}}],init:function(k,g,c){k=k();g=g();return c(k,g)}}),N={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",
sdfGlyphSize:64,textureWidth:2048},xa=new A.Color,ma=Object.create(null),S;U=G.defineWorkerModule({name:"FontProcessor",dependencies:[N,.125,U,function(k){function g(a,b){var c=a.minX,d=a.minY,e=a.maxX,f=a.maxY,h=a.cx,l=a.cy;c<b.minX&&(b.minX=c);d<b.minY&&(b.minY=d);e>b.maxX&&(b.maxX=e);f>b.maxY&&(b.maxY=f);var k=b.data;if(k)if(k.cx===h&&k.cy===l){for(;k.next;)k=k.next;k.next=a}else b.data=null,g(k,b),g(a,b);else h=(l<b.cy?0:2)+(h<b.cx?0:1),b[h]?g(a,b[h]):b[h]={0:null,1:null,2:null,3:null,data:a,
cx:b.cx+b.r/2*(h%2?1:-1),cy:b.cy+b.r/2*(2>h?-1:1),r:b.r/2,minX:c,minY:d,maxX:e,maxY:f}}function c(a,b){if(!1!==b(a)&&!a.data)for(var d=0;4>d;d++)null!==a[d]&&c(a[d],b)}function a(a,b){var d=!1;c(f,function(c){if(c.maxX<a||c.minY>b||c.maxY<b)return!1;for(c=c.data;c;c=c.next){var e=c.x0,f=c.y0,g=c.x1,h=c.y1;f>b!==h>b&&a<(g-e)*(b-f)/(h-f)+e&&(d=!d)}});return d}var b=k.xMin,d=k.yMin,e=k.xMax-b;k=k.yMax-d;var f={0:null,1:null,2:null,3:null,data:null,cx:Math.round(b+e/2),cy:Math.round(d+k/2),r:Math.pow(2,
Math.floor(Math.log(Math.max(e,k))*Math.LOG2E)),minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return{addLineSegment:function(a,b,c,d){g({x0:a,y0:b,x1:c,y1:d,cx:(a+c)/2,cy:(b+d)/2,minX:Math.min(a,c),minY:Math.min(b,d),maxX:Math.max(a,c),maxY:Math.max(b,d),next:null},f)},findNearestSignedDistance:function(b,d,e){var g=e,h=g*g;c(f,function(a){if(b-g>a.maxX||b+g<a.minX||d-g>a.maxY||d+g<a.minY)return!1;for(a=a.data;a;a=a.next){var c=a.x0;var e=a.y0;var f=a.x1-c,k=a.y1-e,l=f*f+k*k;l=l?Math.max(0,
Math.min(1,((b-c)*f+(d-e)*k)/l)):0;c=b-(c+l*f);e=d-(e+l*k);e=c*c+e*e;e<h&&(h=e,g=Math.sqrt(e))}});a(b,d)||(g=-g);return g}}},function(k,g){var c=g.sdfDistancePercent;return function(a,b){var d=new Uint8Array(b*b),e=a.xMax-a.xMin,f=a.yMax-a.yMin,g=Math.max(e,f)*c,l=(e+2*g)/b,q=(f+2*g)/b;f=a.xMin-g-l;e=a.yMin-g-q;l=a.xMax+g+l;q=a.yMax+g+q;if(a.pathCommandCount){var r=k(a),t,p,n,m;a.forEachPathCommand(function(a,b,c,d,e,f,g){switch(a){case "M":n=t=b;m=p=c;break;case "L":b===n&&c===m||r.addLineSegment(n,
m,n=b,m=c);break;case "Q":f={x:n,y:m};for(g=1;16>g;g++){a=g/15;var h=1-a;a={x:h*h*n+2*h*a*b+a*a*d,y:h*h*m+2*h*a*c+a*a*e};r.addLineSegment(f.x,f.y,a.x,a.y);f=a}n=d;m=e;break;case "C":a={x:n,y:m};for(h=1;16>h;h++){var k=h/15;var l=1-k;k={x:l*l*l*n+3*l*l*k*b+3*l*k*k*d+k*k*k*f,y:l*l*l*m+3*l*l*k*c+3*l*k*k*e+k*k*k*g};r.addLineSegment(a.x,a.y,k.x,k.y);a=k}n=f;m=g;break;case "Z":n===t&&m===p||r.addLineSegment(n,m,t,p)}});for(a=0;a<b;a++)for(var u=0;u<b;u++){var v=r.findNearestSignedDistance(f+(l-f)*(a+.5)/
b,e+(q-e)*(u+.5)/b,g);v=isFinite(v)?Math.round(127.5*(1+v/g)):v;v=Math.max(0,Math.min(255,v));d[u*b+a]=v}}return{textureData:d,renderingBounds:[f,e,l,q]}}},function(k,g,c){function a(a,b){function c(){var d=function(b){console.error("Failure loading font "+a+(a===q?"":"; trying fallback"),b);a!==q&&(a=q,c())};try{var e=new XMLHttpRequest;e.open("get",a,!0);e.responseType="arraybuffer";e.onload=function(){if(400<=e.status)d(Error(e.statusText));else if(0<e.status)try{var a=k(e.response);b(a)}catch(y){d(y)}};
e.onerror=d;e.send()}catch(w){d(w)}}c()}function b(b,c){b||(b=q);var d=t[b];d?d.pending?d.pending.push(c):c(d):(t[b]={pending:[c]},a(b,function(a){var c=t[b].pending;t[b]=a;c.forEach(function(b){return b(a)})}))}function d(a,c,d){a||(a=q);var e=a+"@"+c,f=r[e];f?d(f):b(a,function(a){f=r[e]||(r[e]={fontObj:a,glyphs:{},glyphCount:0});d(f)})}function e(a,b,c){var e=a.text;void 0===e&&(e="");var k=a.font;void 0===k&&(k=q);var p=a.sdfGlyphSize;void 0===p&&(p=64);var m=a.fontSize;void 0===m&&(m=1);var n=
a.letterSpacing;void 0===n&&(n=0);var r=a.lineHeight;void 0===r&&(r="normal");var t=a.maxWidth;void 0===t&&(t=Infinity);var A=a.textAlign;void 0===A&&(A="left");var B=a.textIndent;void 0===B&&(B=0);var D=a.whiteSpace;void 0===D&&(D="normal");var x=a.overflowWrap;void 0===x&&(x="normal");var L=a.anchorX;void 0===L&&(L=0);var H=a.anchorY;void 0===H&&(H=0);var G=a.includeCaretPositions;void 0===G&&(G=!1);var N=a.chunkedBoundsSize;void 0===N&&(N=8192);var R=a.colorRanges;void 0===R&&(R=null);void 0===
c&&(c=!1);var Q=h(),M={total:0,fontLoad:0,layout:0,sdf:{},sdfTotal:0};-1<e.indexOf("\r")&&(console.warn("FontProcessor.process: got text with \\r chars; normalizing to \\n"),e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"));m=+m;n=+n;t=+t;r=r||"normal";B=+B;d(k,p,function(a){var d=a.fontObj,k=isFinite(t),q=null,u=null,v=null,w=null,y=null,z=null,E=null,C=0,F=0,S="nowrap"!==D,Z=d.ascender,V=d.descender,aa=d.unitsPerEm;M.fontLoad=h()-Q;var U=h(),J=m/aa;"normal"===r&&(r=(Z-V)/aa);r*=m;aa=(r-(Z-V)*J)/2;
var P=-(m+aa),T=Math.min(r,(Z-V)*J),ca=(Z+V)/2*J-T/2,W=B,I=new l,X=[I];d.forEachGlyph(e,m,n,function(a,b,c){var d=e.charAt(c),f=a.advanceWidth*J,g=I.count;"isEmpty"in a||(a.isWhitespace=!!d&&/\s/.test(d),a.isEmpty=a.xMin===a.xMax||a.yMin===a.yMax);a.isWhitespace||a.isEmpty||F++;if(S&&k&&!a.isWhitespace&&b+f+W>t&&g){if(I.glyphAt(g-1).glyphObj.isWhitespace){var h=new l;W=-b}else for(;g--;)if(0===g&&"break-word"===x){h=new l;W=-b;break}else if(I.glyphAt(g).glyphObj.isWhitespace){h=I.splitAt(g+1);g=h.glyphAt(0).x;
W-=g;for(var p=h.count;p--;)h.glyphAt(p).x-=g;break}h&&(I.isSoftWrapped=!0,I=h,X.push(I),C=t)}h=I.glyphAt(I.count);h.glyphObj=a;h.x=b+W;h.width=f;h.charIndex=c;"\n"===d&&(I=new l,X.push(I),W=-(b+f+n*m)+B)});X.forEach(function(a){for(var b=a.count;b--;){var c=a.glyphAt(b),d=c.x,e=c.width;if(!c.glyphObj.isWhitespace){a.width=d+e;a.width>C&&(C=a.width);break}}});if(!c){var Y=0,ba=0;L&&("number"===typeof L?Y=-L:"string"===typeof L&&(Y=-C*("left"===L?0:"center"===L?.5:"right"===L?1:f(L))));H&&("number"===
typeof H?ba=-H:"string"===typeof H&&(d=X.length*r,ba="top"===H?0:"top-baseline"===H?-P:"middle"===H?d/2:"bottom"===H?d:"bottom-baseline"===H?d-aa+V*J:f(H)*d));u=new Float32Array(4*F);v=new Float32Array(F);z=[Infinity,Infinity,-Infinity,-Infinity];E=[];var fa=P;G&&(y=new Float32Array(3*e.length));R&&(w=new Uint8Array(3*F));var da=0,O=-1,ha=-1,K,ia;X.forEach(function(b){var c=b.count,d=b.width;if(0<c){var f=0,k=0;if("center"===A)f=(C-d)/2;else if("right"===A)f=C-d;else if("justify"===A&&b.isSoftWrapped){k=
0;for(var l=c;l--;)if(!b.glyphAt(l).glyphObj.isWhitespace){for(;l--;){if(!b.glyphAt(l).glyphObj)debugger;b.glyphAt(l).glyphObj.isWhitespace&&k++}break}k=(C-d)/k}for(d=0;d<c;d++){l=b.glyphAt(d);var m=l.glyphObj;f&&(l.x+=f);0!==k&&m.isWhitespace&&(f+=k,l.width+=k);if(G){var n=l.charIndex;y[3*n]=l.x+Y;y[3*n+1]=l.x+l.width+Y;for(y[3*n+2]=fa+ca+ba;1<n-O;)y[3*(O+1)]=y[3*O+1],y[3*(O+1)+1]=y[3*O+1],y[3*(O+1)+2]=y[3*O+2],O++;O=n}if(R)for(n=l.charIndex;n>ha;)ha++,R.hasOwnProperty(ha)&&(ia=R[ha]);if(!m.isWhitespace&&
!m.isEmpty){n=da++;var t=a.glyphs[m.index];if(!t){t=h();var x=g(m,p);M.sdf[e.charAt(l.charIndex)]=h()-t;x.atlasIndex=a.glyphCount++;q||(q=[]);q.push(x);t=a.glyphs[m.index]={atlasIndex:x.atlasIndex,glyphObj:m,renderingBounds:x.renderingBounds}}var B=t.renderingBounds,D=4*n;m=u[D]=l.x+B[0]*J+Y;x=u[D+1]=fa+B[1]*J+ba;l=u[D+2]=l.x+B[2]*J+Y;B=u[D+3]=fa+B[3]*J+ba;m<z[0]&&(z[0]=m);x<z[1]&&(z[1]=x);l>z[2]&&(z[2]=l);B>z[3]&&(z[3]=B);0===n%N&&(K={start:n,end:n,rect:[Infinity,Infinity,-Infinity,-Infinity]},E.push(K));
K.end++;m<K.rect[0]&&(K.rect[0]=m);x<K.rect[1]&&(K.rect[1]=x);l>K.rect[2]&&(K.rect[2]=l);B>K.rect[3]&&(K.rect[3]=B);v[n]=t.atlasIndex;R&&(l=3*n,w[l]=ia>>16&255,w[l+1]=ia>>8&255,w[l+2]=ia&255)}}}fa-=r})}for(var ea in M.sdf)M.sdfTotal+=M.sdf[ea];M.layout=h()-U-M.sdfTotal;M.total=h()-Q;b({glyphBounds:u,glyphAtlasIndices:v,caretPositions:y,caretHeight:T,glyphColors:w,chunkedBounds:E,ascender:Z*J,descender:V*J,lineHeight:r,topBaseline:P,totalBounds:z,totalBlockSize:[C,X.length*r],newGlyphSDFs:q,timings:M})})}
function f(a){a=(a=a.match(/^([\d.]+)%$/))?parseFloat(a[1]):NaN;return isNaN(a)?0:a/100}function h(){return(self.performance||Date).now()}function l(){this.data=[]}var q=c.defaultFontUrl,r=Object.create(null),t=Object.create(null);l.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/4)},glyphAt:function(a){var b=l.flyweight;b.data=this.data;b.index=a;return b},splitAt:function(a){var b=new l;b.data=this.data.splice(4*a);return b}};l.flyweight=["glyphObj","x","width",
"charIndex"].reduce(function(a,b,c,d){Object.defineProperty(a,b,{get:function(){return this.data[4*this.index+c]},set:function(a){this.data[4*this.index+c]=a}});return a},{data:null,index:0});return{process:e,measure:function(a,b){e(a,function(a){b({width:a.totalBlockSize[0],height:a.totalBlockSize[1]})},{metricsOnly:!0})},loadFont:b}}],init:function(k,g,c,a,b,d){g=b(a,{sdfDistancePercent:g});return d(c,g,{defaultFontUrl:k.defaultFontURL})}});var ya=G.defineWorkerModule({name:"TextBuilder",dependencies:[U,
G.ThenableWorkerModule],init:function(k,g){return function(c){var a=new g;k.process(c,a.resolve);return a}},getTransferables:function(k){var g=[k.glyphBounds.buffer,k.glyphAtlasIndices.buffer];k.caretPositions&&g.push(k.caretPositions.buffer);k.newGlyphSDFs&&k.newGlyphSDFs.forEach(function(c){g.push(c.textureData.buffer)});return g}}),na={},Ba=new A.Vector3,P=function(k){function g(){k.call(this);this.detail=1;this.boundingSphere=new A.Sphere;this.boundingBox=new A.Box3}k&&(g.__proto__=k);g.prototype=
Object.create(k&&k.prototype);g.prototype.constructor=g;var c={detail:{configurable:!0}};g.prototype.computeBoundingSphere=function(){};g.prototype.computeBoundingBox=function(){};c.detail.set=function(a){var b=this;if(a!==this._detail){this._detail=a;if("number"!==typeof a||1>a)a=1;var c=za(a);["position","normal","uv"].forEach(function(a){b.attributes[a]=c.attributes[a].clone()});this.setIndex(c.getIndex().clone())}};c.detail.get=function(){return this._detail};g.prototype.updateGlyphs=function(a,
b,c,e,f){T(this,"aTroikaGlyphBounds",a,4);T(this,"aTroikaGlyphIndex",b,1);T(this,"aTroikaGlyphColor",f,3);this._chunkedBounds=e;oa(this,b.length);a=this.boundingSphere;a.center.set((c[0]+c[2])/2,(c[1]+c[3])/2,0);a.radius=a.center.distanceTo(Ba.set(c[0],c[1],0));a=this.boundingBox;a.min.set(c[0],c[1],0);a.max.set(c[2],c[3],0)};g.prototype.applyClipRect=function(a){var b=this.getAttribute("aTroikaGlyphIndex").count,c=this._chunkedBounds;if(c)for(var e=c.length;e--;){b=c[e].end;var f=c[e].rect;if(f[1]<
a.w&&f[3]>a.y&&f[0]<a.z&&f[2]>a.x)break}oa(this,b)};Object.defineProperties(g.prototype,c);return g}(A.InstancedBufferGeometry);P.prototype.setAttribute||(P.prototype.setAttribute=function(k,g){this.attributes[k]=g;return this});var ra=new A.MeshBasicMaterial({color:16777215,side:A.DoubleSide,transparent:!0}),ca=new A.Matrix4,sa=new A.Vector3,da=new A.Vector3,Q=[],Ca=new A.Vector3,ta=new A.Mesh((new A.PlaneBufferGeometry(1,1)).translate(.5,.5,0),ra),Da={type:"syncstart"},Ea={type:"synccomplete"};
G="font fontSize letterSpacing lineHeight maxWidth overflowWrap text textAlign textIndent whiteSpace anchorX anchorY colorRanges sdfGlyphSize".split(" ");var Fa=G.concat("material","color","depthOffset","clipRect","orientation","glyphGeometryDetail"),ea=function(k){function g(){var a=new P;k.call(this,a,null);this.text="";this.anchorY=this.anchorX=0;this.font=null;this.fontSize=.1;this.letterSpacing=0;this.lineHeight="normal";this.maxWidth=Infinity;this.overflowWrap="normal";this.textAlign="left";
this.textIndent=0;this.whiteSpace="normal";this.colorRanges=this.color=this.material=null;this.depthOffset=0;this.clipRect=null;this.orientation="+x+y";this.glyphGeometryDetail=1;this.sdfGlyphSize=null;this.debugSDF=!1}k&&(g.__proto__=k);g.prototype=Object.create(k&&k.prototype);g.prototype.constructor=g;var c={textRenderInfo:{configurable:!0},material:{configurable:!0},glyphGeometryDetail:{configurable:!0},customDepthMaterial:{configurable:!0},customDistanceMaterial:{configurable:!0}};g.prototype.sync=
function(a){var b=this;this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(a):(this._isSyncing=!0,this.dispatchEvent(Da),ka({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,
includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize},function(c){b._isSyncing=!1;b._textRenderInfo=c;b.geometry.updateGlyphs(c.glyphBounds,c.glyphAtlasIndices,c.totalBounds,c.chunkedBounds,c.glyphColors);var d=b._queuedSyncs;d&&(b._queuedSyncs=null,b._needsSync=!0,b.sync(function(){d.forEach(function(a){return a&&a()})}));b.dispatchEvent(Ea);a&&a()})))};g.prototype.onBeforeRender=function(){this.sync();this._prepareForRender()};g.prototype.dispose=function(){this.geometry.dispose()};c.textRenderInfo.get=
function(){return this._textRenderInfo||null};c.material.get=function(){var a=this._derivedMaterial,b=this._baseMaterial||ra;a&&a.baseMaterial===b||(a=this._derivedMaterial=pa(b),b.addEventListener("dispose",function e(){b.removeEventListener("dispose",e);a.dispose()}));return a};c.material.set=function(a){a&&a.isTroikaTextMaterial?(this._derivedMaterial=a,this._baseMaterial=a.baseMaterial):this._baseMaterial=a};c.glyphGeometryDetail.get=function(){return this.geometry.detail};c.glyphGeometryDetail.set=
function(a){this.geometry.detail=a};c.customDepthMaterial.get=function(){return this.material.getDepthMaterial()};c.customDistanceMaterial.get=function(){return this.material.getDistanceMaterial()};g.prototype._prepareForRender=function(){var a=this._derivedMaterial,b=a.uniforms,c=this.textRenderInfo;if(c){var e=c.sdfTexture,f=c.totalBounds;b.uTroikaSDFTexture.value=e;b.uTroikaSDFTextureSize.value.set(e.image.width,e.image.height);b.uTroikaSDFGlyphSize.value=c.sdfGlyphSize;b.uTroikaSDFMinDistancePct.value=
c.sdfMinDistancePercent;b.uTroikaTotalBounds.value.fromArray(f);b.uTroikaUseGlyphColors.value=!!c.glyphColors;(c=this.clipRect)&&Array.isArray(c)&&4===c.length?b.uTroikaClipRect.value.set(Math.max(f[0],c[0]),Math.max(f[1],c[1]),Math.min(f[2],c[2]),Math.min(f[3],c[3])):b.uTroikaClipRect.value.fromArray(f);this.geometry.applyClipRect(b.uTroikaClipRect.value)}b.uTroikaSDFDebug.value=!!this.debugSDF;a.polygonOffset=!!this.depthOffset;a.polygonOffsetFactor=a.polygonOffsetUnits=this.depthOffset||0;f=this.color;
null!=f&&a.color&&a.color.isColor&&f!==a._troikaColor&&a.color.set(a._troikaColor=f);f=this.orientation||"+x+y";if(f!==a._orientation){b=b.uTroikaOrient.value;f=f.replace(/[^-+xyz]/g,"");var g="+x+y"!==f&&f.match(/^([-+])([xyz])([-+])([xyz])$/);if(g){c=g[1];e=g[2];var k=g[3];g=g[4];sa.set(0,0,0)[e]="-"===c?1:-1;da.set(0,0,0)[g]="-"===k?-1:1;ca.lookAt(Ca,sa.cross(da),da);b.setFromMatrix4(ca)}else b.identity();a._orientation=f}};g.prototype.raycast=function(a,c){var b=this.textRenderInfo;if(b)for(b=
b.totalBounds,ta.matrixWorld.multiplyMatrices(this.matrixWorld,ca.set(b[2]-b[0],0,0,b[0],0,b[3]-b[1],0,b[1],0,0,1,0,0,0,0,1)),Q.length=0,ta.raycast(a,Q),a=0;a<Q.length;a++)Q[a].object=this,c.push(Q[a])};g.prototype.copy=function(a){var b=this;k.prototype.copy.call(this,a);Fa.forEach(function(c){b[c]=a[c]});return this};g.prototype.clone=function(){return(new this.constructor).copy(this)};Object.defineProperties(g.prototype,c);return g}(A.Mesh);G.forEach(function(k){var g="_private_"+k;Object.defineProperty(ea.prototype,
k,{get:function(){return this[g]},set:function(c){c!==this[g]&&(this[g]=c,this._needsSync=!0)}})});var ua=!1;Object.defineProperty(ea.prototype,"anchor",{get:function(){return this._deprecated_anchor},set:function(k){this._deprecated_anchor=k;ua||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),ua=!0);Array.isArray(k)?(this.anchorX=100*(+k[0]||0)+"%",this.anchorY=100*(+k[1]||0)+"%"):this.anchorX=this.anchorY=0}});var va=new WeakMap,qa=new WeakMap;D.GlyphsGeometry=
P;D.Text=ea;D.configureTextBuilder=function(k){la(N,k)};D.createTextDerivedMaterial=pa;D.fontProcessorWorkerModule=U;D.getCaretAtPoint=function(k,g,c){var a=null,b=k.caretHeight;k=Aa(k);var d=Infinity;k.forEach(function(a,f){Math.abs(c-(f+b/2))<Math.abs(c-(d+b/2))&&(d=f)});k.get(d).forEach(function(b){if(!a||Math.abs(g-b.x)<Math.abs(g-a.x))a=b});return a};D.getSelectionRects=function(k,g,c){if(k){var a=va.get(k);if(a&&a.start===g&&a.end===c)return a.rects;a=k.caretPositions;var b=k.caretHeight,d=
k.totalBounds;if(c<g){var e=g;g=c;c=e}g=Math.max(g,0);c=Math.min(c,a.length+1);e=new Map;for(var f=g;f<c;f++){var h=a[3*f],l=a[3*f+1],q=a[3*f+2],r=e.get(q);r?(r.left=Math.max(Math.min(r.left,h),d[0]),r.right=Math.min(Math.max(r.right,l),d[2])):(r={left:h,right:l,bottom:q,top:q+b},e.set(q,r))}var t=[];e.forEach(function(a){t.push(a)});va.set(k,{start:g,end:c,rects:t})}return t};D.preloadFont=function(k,g){var c=k.font,a=k.characters;k=k.sdfGlyphSize;a=Array.isArray(a)?a.join("\n"):""+a;ka({font:c,
sdfGlyphSize:k,text:a},g)};Object.defineProperty(D,"__esModule",{value:!0})})
